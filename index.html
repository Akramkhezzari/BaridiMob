<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</title>
  
  <!-- Telegram Web App SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    /* Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ© Ø§Ù„Ø£ØµÙ„ÙŠØ© */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    :root {
      --primary: #006633;
      --secondary: #00cc66;
      --dollar-blue: #0057b7;
      --dollar-light: #2d87ff;
      --danger: #ff4757;
      --success: #26a17b;
      --warning: #ff9f00;
      --info: #2d87ff;
      --bg-light: #ffffff;
      --bg-lighter: #f8f9fa;
      --text-dark: #1a1a1a;
      --text-gray: #666;
      --text-light: #888;
      --border-light: rgba(0, 0, 0, 0.1);
      --shadow-light: rgba(0, 0, 0, 0.08);
    }

    body {
      background: #ffffff;
      color: var(--text-dark);
      min-height: 100vh;
      padding: 0;
    }

    .wallet-page {
      padding: 15px;
      background: #ffffff;
      min-height: 100vh;
    }

    .wallet-frame {
      width: 100%;
      max-width: 420px;
      margin: 0 auto;
      background: #ffffff;
      overflow: hidden;
      position: relative;
    }

    .wallet-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 12px 0;
      border-bottom: 1px solid var(--border-light);
      margin-bottom: 15px;
    }

    .wallet-brand {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .wallet-avatar {
      width: 52px;
      height: 52px;
      border-radius: 999px;
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      box-shadow: 0 2px 8px var(--shadow-light);
      border: 1px solid rgba(255, 255, 255, 0.8);
    }

    .wallet-coin-icon {
      width: 38px;
      height: 38px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 16px;
      color: #ffffff;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      box-shadow: 0 4px 12px rgba(0,102,51,0.2);
      transform-origin: center;
    }

    .wallet-user-meta {
      text-align: right;
    }

    .wallet-user-meta .name {
      font-weight: 700;
      font-size: 14px;
      color: var(--text-dark);
    }

    .wallet-user-meta .sub {
      font-size: 11px;
      color: var(--text-light);
      cursor: pointer;
      transition: all 0.3s ease;
      padding: 2px 6px;
      border-radius: 6px;
    }

    .wallet-user-meta .sub:hover {
      background: rgba(0, 102, 51, 0.1);
      color: var(--primary);
    }

    .wallet-controls {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .wallet-channel-btn {
      padding: 8px 12px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      border: none;
      cursor: pointer;
      color: #ffffff;
      transition: all 0.3s ease;
      font-size: 12px;
      font-weight: 600;
      text-decoration: none;
      box-shadow: 0 2px 8px rgba(0,102,51,0.2);
    }

    .wallet-content {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .wallet-balance-card {
      background: linear-gradient(135deg, #f8f9fa, #ffffff);
      border-radius: 16px;
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border: 1px solid rgba(0, 102, 51, 0.1);
      box-shadow: 0 4px 16px var(--shadow-light);
    }

    .wallet-balance-left {
      text-align: right;
    }

    .wallet-bal-label {
      color: var(--text-light);
      font-size: 12px;
    }

    .wallet-bal-amount {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-dark);
      margin-top: 6px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .wallet-bal-trend {
      font-size: 12px;
      color: var(--success);
      background: rgba(38, 161, 123, 0.1);
      padding: 6px 8px;
      border-radius: 10px;
      font-weight: 700;
      border: 1px solid rgba(38, 161, 123, 0.2);
    }

    .wallet-bal-trend.negative {
      color: var(--danger);
      background: rgba(255, 71, 87, 0.1);
      border-color: rgba(255, 71, 87, 0.2);
    }

    .wallet-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .wallet-neon-btn {
      flex: 1;
      padding: 12px;
      border-radius: 12px;
      border: none;
      font-weight: 700;
      cursor: pointer;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      color: #ffffff;
      box-shadow: 0 4px 16px rgba(0,102,51,0.2);
      font-size: 14px;
      transition: all 0.3s ease;
      min-width: 120px;
    }

    .wallet-send-btn {
      flex: 1;
      padding: 12px;
      border-radius: 12px;
      border: none;
      font-weight: 700;
      cursor: pointer;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      color: #ffffff;
      box-shadow: 0 4px 16px rgba(0,102,51,0.2);
      font-size: 14px;
      transition: all 0.3s ease;
      min-width: 120px;
    }

    .wallet-exchange-btn {
      flex: 1;
      padding: 12px;
      border-radius: 12px;
      border: none;
      font-weight: 700;
      cursor: pointer;
      background: linear-gradient(90deg, #8e44ad, #9b59b6);
      color: #ffffff;
      box-shadow: 0 4px 16px rgba(142, 68, 173, 0.2);
      font-size: 14px;
      transition: all 0.3s ease;
      min-width: 120px;
    }

    .wallet-ghost-btn {
      flex: 1;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid var(--border-light);
      background: #f8f9fa;
      color: var(--text-gray);
      font-weight: 700;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .wallet-section-title {
      font-size: 13px;
      color: var(--text-gray);
      margin-bottom: 8px;
      font-weight: 600;
    }

    .wallet-wallets {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .wallet-coin-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px;
      border-radius: 12px;
      background: #f8f9fa;
      border: 1px solid transparent;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .wallet-badge {
      width: 42px;
      height: 42px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 14px;
      color: #ffffff;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      box-shadow: 0 4px 12px rgba(0,102,51,0.2);
    }

    .wallet-badge.usd {
      background: linear-gradient(90deg, var(--dollar-blue), var(--dollar-light));
      box-shadow: 0 4px 12px rgba(0, 87, 183, 0.2);
    }

    .wallet-coin-meta {
      text-align: right;
    }

    .wallet-coin-meta .n {
      font-weight: 700;
      font-size: 14px;
      color: var(--text-dark);
    }

    .wallet-coin-meta .s {
      font-size: 11px;
      color: var(--text-light);
      margin-top: 4px;
    }

    .wallet-coin-meta .rate {
      font-size: 10px;
      color: var(--text-gray);
      margin-top: 2px;
    }

    .wallet-coin-val {
      text-align: left;
    }

    .wallet-coin-val .qty {
      font-weight: 700;
      font-size: 14px;
      color: var(--text-dark);
    }

    .wallet-coin-val .fiat {
      font-size: 11px;
      color: var(--text-light);
      margin-top: 4px;
    }

    .wallet-coin-val .change {
      font-size: 10px;
      margin-top: 2px;
      font-weight: 600;
    }

    .change.positive {
      color: var(--success);
    }

    .change.negative {
      color: var(--danger);
    }

    .wallet-smallnote {
      text-align: center;
      color: var(--text-light);
      font-size: 11px;
      padding: 20px 0 10px;
      opacity: 0.7;
    }

    .wallet-loading-spinner {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255,255,255,0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }

    .wallet-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(0,102,51,0.3);
      border-radius: 50%;
      border-top-color: var(--primary);
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Ø£Ù†Ù…Ø§Ø· Ø´Ø¨ÙƒØ© Ø§Ù„ØªØ¨Ø§Ø¯Ù„ */
    .exchange-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255,255,255,0.95);
      z-index: 200;
      display: none;
      overflow-y: auto;
    }

    .exchange-modal.open {
      display: block;
    }

    .exchange-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px 15px;
      text-align: center;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .exchange-close-btn {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .exchange-filters {
      padding: 15px;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 8px;
      background: white;
      border-bottom: 1px solid var(--border-light);
    }

    .exchange-filter-btn {
      padding: 8px 16px;
      border-radius: 20px;
      background: white;
      border: 1px solid var(--border-light);
      color: var(--text-dark);
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .exchange-filter-btn.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .exchange-container {
      padding: 15px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 15px;
      background: #f8f9fa;
      min-height: calc(100vh - 180px);
    }

    @media (max-width: 768px) {
      .exchange-container {
        grid-template-columns: 1fr;
      }
    }

    .exchange-card {
      background: white;
      border: 1px solid var(--border-light);
      border-radius: 12px;
      padding: 15px;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      box-shadow: 0 3px 10px rgba(0,0,0,0.05);
    }

    .exchange-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .exchange-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .exchange-badge.sell-usd {
      background: rgba(239, 68, 68, 0.1);
      color: var(--danger);
      border: 1px solid rgba(239, 68, 68, 0.2);
    }

    .exchange-badge.sell-dzd {
      background: rgba(34, 197, 94, 0.1);
      color: var(--success);
      border: 1px solid rgba(34, 197, 94, 0.2);
    }

    .exchange-user-info {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .exchange-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      font-weight: bold;
      color: white;
    }

    .exchange-card-body {
      flex-grow: 1;
    }

    .exchange-currency-info {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .exchange-rate {
      text-align: left;
    }

    .exchange-rate-label {
      display: block;
      font-size: 0.8rem;
      color: var(--text-light);
      margin-bottom: 4px;
    }

    .exchange-rate-value {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text-dark);
    }

    .exchange-info {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin: 12px 0;
      font-size: 0.9rem;
      color: var(--text-gray);
    }

    .exchange-details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin: 12px 0;
      font-size: 0.85rem;
    }

    .exchange-detail-label {
      color: var(--text-light);
      font-size: 0.75rem;
      margin-bottom: 4px;
    }

    .exchange-detail-value {
      color: var(--text-dark);
      font-weight: 500;
      font-size: 0.85rem;
    }

    .exchange-total-container {
      background: var(--bg-lighter);
      border-radius: 8px;
      padding: 12px;
      margin: 12px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 1px solid var(--border-light);
    }

    .exchange-total-label {
      font-size: 0.9rem;
      color: var(--text-dark);
      font-weight: 600;
    }

    .exchange-total-value {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text-dark);
    }

    .exchange-action-btn {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 10px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-top: 8px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .exchange-create-btn {
      position: fixed;
      bottom: 25px;
      left: 25px;
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      transition: all 0.3s ease;
      z-index: 100;
      border: none;
    }

    .exchange-footer {
      padding: 15px;
      border-top: 1px solid var(--border-light);
      color: var(--text-light);
      font-size: 0.85rem;
      text-align: center;
      background: white;
    }

    /* Ù†Ø§ÙØ°Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ ØªØ¨Ø§Ø¯Ù„ */
    .create-exchange-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255,255,255,0.95);
      z-index: 400;
      overflow-y: auto;
    }

    .create-exchange-modal.open {
      display: block;
    }

    .create-exchange-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px 15px;
      text-align: center;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .create-exchange-close-btn {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .create-exchange-form {
      padding: 20px;
      max-width: 500px;
      margin: 0 auto;
    }

    .balance-info {
      background: var(--bg-lighter);
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      border: 1px solid var(--border-light);
    }

    /* Ù†Ø§ÙØ°Ø© Ø­ÙˆØ§Ø± Ø§Ù„ØªØ¨Ø§Ø¯Ù„ */
    .exchange-dialog {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 300;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .exchange-dialog-content {
      background: white;
      border-radius: 16px;
      padding: 25px;
      width: 100%;
      max-width: 450px;
      border: 1px solid var(--border-light);
      box-shadow: 0 15px 40px rgba(0,0,0,0.15);
      animation: slideInUp 0.3s ease;
    }

    @keyframes slideInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .exchange-dialog-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .exchange-dialog-close {
      background: none;
      border: none;
      color: var(--text-light);
      font-size: 24px;
      cursor: pointer;
      line-height: 1;
      padding: 5px;
    }

    .exchange-dialog-message {
      background: var(--bg-lighter);
      padding: 15px;
      border-radius: 10px;
      margin: 15px 0;
      line-height: 1.6;
      font-size: 0.95rem;
      border: 1px solid var(--border-light);
    }

    .exchange-dialog-details {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin: 20px 0;
    }

    .exchange-dialog-actions {
      display: flex;
      gap: 12px;
      margin-top: 25px;
    }

    .exchange-dialog-btn {
      flex: 1;
      padding: 12px;
      border-radius: 10px;
      border: none;
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .exchange-dialog-btn.confirm {
      background: linear-gradient(135deg, var(--success), #22c55e);
      color: white;
    }

    .exchange-dialog-btn.cancel {
      background: var(--bg-lighter);
      color: var(--text-dark);
      border: 1px solid var(--border-light);
    }

    /* Ø£Ù†Ù…Ø§Ø· Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø£Ù…ÙˆØ§Ù„ */
    .receive-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255,255,255,0.97);
      backdrop-filter: blur(10px);
      z-index: 200;
      display: none;
      overflow-y: auto;
    }

    .receive-modal.open {
      display: block;
    }

    .receive-header {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      padding: 20px 15px;
      text-align: center;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .receive-close-btn {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .receive-content {
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
    }

    .receive-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 20px;
    }

    @media (max-width: 768px) {
      .receive-grid {
        grid-template-columns: 1fr;
      }
    }

    /* ÙƒØ§Ø±Ø¯ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
    .bank-card {
      background: var(--bg-light);
      border-radius: 16px;
      padding: 25px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.08);
      transition: all 0.3s ease;
      border: 1px solid rgba(0, 102, 51, 0.1);
      position: relative;
      overflow: hidden;
    }

    .bank-card:before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 100%;
      height: 4px;
      background: linear-gradient(to left, var(--primary), var(--secondary));
    }

    .bank-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.12);
    }

    .bank-card-title {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      color: var(--primary);
      font-size: 20px;
      font-weight: 700;
    }

    .bank-info-container {
      margin-bottom: 20px;
    }

    .bank-info-box {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--bg-lighter);
      border-radius: 10px;
      padding: 14px 18px;
      border: 1px solid var(--border-light);
      transition: all 0.3s ease;
    }

    .bank-info-value {
      font-family: 'Courier New', monospace;
      font-size: 15px;
      color: var(--text-dark);
      word-break: break-all;
      padding-left: 10px;
      font-weight: 600;
    }

    .bank-copy-btn {
      background: linear-gradient(to right, var(--primary), var(--secondary));
      color: white;
      border: none;
      border-radius: 8px;
      padding: 8px 16px;
      font-size: 13px;
      cursor: pointer;
      display: flex;
      align-items: center;
      transition: all 0.3s ease;
      white-space: nowrap;
      font-weight: 600;
      box-shadow: 0 3px 8px rgba(0,102,51,0.2);
    }

    .bank-hint {
      font-size: 12px;
      color: var(--text-light);
      margin-top: 8px;
      display: flex;
      align-items: center;
    }

    .bank-badge {
      display: inline-block;
      background: linear-gradient(to right, var(--secondary), #3ab5e0);
      color: white;
      padding: 4px 10px;
      border-radius: 15px;
      font-size: 11px;
      font-weight: 600;
      margin-right: 10px;
    }

    .bank-form-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .bank-form-input {
      background-color: var(--bg-lighter);
      border: 2px solid var(--border-light);
      border-radius: 10px;
      padding: 14px 18px;
      font-size: 15px;
      color: var(--text-dark);
      transition: all 0.3s ease;
    }

    .bank-form-input:focus {
      outline: none;
      border-color: var(--primary);
      background-color: white;
      box-shadow: 0 0 0 3px rgba(0, 102, 51, 0.15);
    }

    .bank-form-select {
      background-color: var(--bg-lighter);
      border: 2px solid var(--border-light);
      border-radius: 10px;
      padding: 14px 18px;
      font-size: 15px;
      color: var(--text-dark);
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .bank-submit-btn {
      background: linear-gradient(to right, var(--success), #26c97c);
      color: white;
      border: none;
      border-radius: 10px;
      padding: 16px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: all 0.3s ease;
      margin-top: 10px;
      box-shadow: 0 4px 12px rgba(46, 204, 113, 0.3);
    }

    .bank-amount-container {
      position: relative;
    }

    .bank-currency-symbol {
      position: absolute;
      left: 18px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-gray);
      font-weight: 600;
      background-color: var(--border-light);
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 14px;
    }

    .bank-success-animation {
      display: none;
      text-align: center;
      margin-top: 20px;
      background-color: rgba(46, 204, 113, 0.1);
      padding: 20px;
      border-radius: 10px;
      border: 1px solid rgba(46, 204, 113, 0.3);
    }

    .bank-notification {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(-100px);
      background: linear-gradient(to right, var(--primary), var(--secondary));
      color: white;
      padding: 14px 25px;
      border-radius: 10px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      z-index: 1000;
      font-weight: 600;
      display: flex;
      align-items: center;
      min-width: 280px;
      text-align: center;
      justify-content: center;
    }

    .bank-notification.show {
      transform: translateX(-50%) translateY(0);
    }

    /* Ø£Ù†Ù…Ø§Ø· Ù†Ø¸Ø§Ù… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
    .money-transfer-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255,255,255,0.95);
      z-index: 200;
      display: none;
      overflow-y: auto;
    }

    .money-transfer-modal.open {
      display: block;
    }

    .transfer-header {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      padding: 20px 15px;
      text-align: center;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .transfer-header h1 {
      font-size: 1.4rem;
      font-weight: 700;
      margin-bottom: 5px;
      margin-top: 0;
    }

    .transfer-header p {
      opacity: 0.9;
      font-size: 0.9rem;
      margin-bottom: 0;
    }

    .transfer-close-btn {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      font-size: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      z-index: 11;
    }

    .transfer-close-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-50%) scale(1.1);
    }

    .back-btn {
      display: none;
    }

    .transfer-content {
      padding: 20px;
      max-width: 500px;
      margin: 0 auto;
      width: 100%;
      box-sizing: border-box;
    }

    .step-indicator {
      display: flex;
      justify-content: space-between;
      margin-bottom: 30px;
      position: relative;
    }

    .step-indicator::before {
      content: '';
      position: absolute;
      top: 15px;
      right: 0;
      width: 100%;
      height: 2px;
      background: var(--border-light);
      z-index: 1;
    }

    .step {
      position: relative;
      z-index: 2;
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 80px;
    }

    .step-circle {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: white;
      border: 2px solid var(--border-light);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: var(--text-gray);
      margin-bottom: 8px;
      transition: all 0.3s;
    }

    .step.active .step-circle {
      background: var(--primary);
      border-color: var(--primary);
      color: white;
      transform: scale(1.1);
    }

    .step.completed .step-circle {
      background: var(--success);
      border-color: var(--success);
      color: white;
    }

    .step-label {
      font-size: 0.8rem;
      color: var(--text-gray);
      text-align: center;
    }

    .step.active .step-label {
      color: var(--primary);
      font-weight: 600;
    }

    .step-content {
      display: none;
      animation: fadeIn 0.5s ease;
    }

    .step-content.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .step-card {
      background: var(--bg-lighter);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 25px;
      border: 1px solid var(--border-light);
    }

    .step-title {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      color: var(--primary);
      font-size: 1.2rem;
      font-weight: 600;
    }

    .step-title i {
      margin-left: 10px;
      font-size: 1.5rem;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--text-dark);
    }

    .input-with-icon {
      position: relative;
    }

    .input-with-icon i {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-gray);
    }

    .form-input {
      width: 100%;
      padding: 15px 45px 15px 15px;
      border: 2px solid var(--border-light);
      border-radius: 10px;
      font-size: 1rem;
      transition: all 0.3s;
      background: white;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(0, 102, 51, 0.1);
    }

    .currency-options {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .currency-btn {
      flex: 1;
      padding: 12px;
      border: 2px solid var(--border-light);
      border-radius: 10px;
      background: white;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
      text-align: center;
    }

    .currency-btn:hover {
      border-color: var(--primary);
    }

    .currency-btn.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .currency-btn.usd.active {
      background: var(--dollar-blue);
      border-color: var(--dollar-light);
    }

    .quick-amounts {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-top: 15px;
    }

    .amount-btn {
      padding: 12px;
      border: 2px solid var(--border-light);
      border-radius: 10px;
      background: white;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
      text-align: center;
    }

    .amount-btn:hover {
      border-color: var(--primary);
      color: var(--primary);
    }

    .balance-info {
      background: linear-gradient(to right, rgba(0, 102, 51, 0.05), rgba(0, 204, 102, 0.05));
      border: 1px solid rgba(0, 102, 51, 0.1);
      border-radius: 10px;
      padding: 15px;
      margin-top: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .balance-label {
      color: var(--text-gray);
      font-size: 0.9rem;
    }

    .balance-amount {
      font-weight: 700;
      color: var(--primary);
      font-size: 1.1rem;
    }

    .transaction-details {
      background: white;
      border-radius: 15px;
      padding: 20px;
      border: 1px solid var(--border-light);
      margin-top: 25px;
    }

    .detail-row {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid var(--border-light);
    }

    .detail-row:last-child {
      border-bottom: none;
      font-weight: 700;
      color: var(--primary);
      font-size: 1.1rem;
      padding-top: 15px;
    }

    .detail-label {
      color: var(--text-gray);
    }

    .detail-value {
      font-weight: 600;
    }

    .navigation-btns {
      display: flex;
      gap: 15px;
      margin-top: 30px;
    }

    .nav-btn {
      flex: 1;
      padding: 16px;
      border-radius: 10px;
      border: none;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .nav-btn.back {
      background: var(--bg-lighter);
      color: var(--text-dark);
      border: 2px solid var(--border-light);
    }

    .nav-btn.back:hover {
      background: #e9ecef;
    }

    .nav-btn.next {
      background: linear-gradient(to right, var(--primary), var(--secondary));
      color: white;
      box-shadow: 0 4px 15px rgba(0, 102, 51, 0.2);
    }

    .nav-btn.next:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 102, 51, 0.3);
    }

    .nav-btn.confirm {
      background: linear-gradient(to right, var(--success), #22c55e);
      color: white;
      box-shadow: 0 4px 15px rgba(38, 161, 123, 0.2);
    }

    .nav-btn.confirm:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(38, 161, 123, 0.3);
    }

    .success-screen {
      text-align: center;
      padding: 40px 30px;
      display: none;
    }

    .success-icon {
      width: 80px;
      height: 80px;
      background: var(--success);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 25px;
      font-size: 2.5rem;
      animation: bounce 1s;
    }

    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
      40% {transform: translateY(-20px);}
      60% {transform: translateY(-10px);}
    }

    .success-title {
      font-size: 1.8rem;
      color: var(--success);
      margin-bottom: 10px;
      font-weight: 700;
    }

    .success-message {
      color: var(--text-gray);
      margin-bottom: 30px;
      line-height: 1.6;
    }

    .alert {
      padding: 15px;
      border-radius: 10px;
      margin: 15px 0;
      display: none;
    }

    .alert.error {
      background: rgba(239, 68, 68, 0.1);
      color: #dc2626;
      border: 1px solid rgba(239, 68, 68, 0.2);
    }

    .alert.success {
      background: rgba(34, 197, 94, 0.1);
      color: #16a34a;
      border: 1px solid rgba(34, 197, 94, 0.2);
    }

    @media (max-width: 480px) {
      .transfer-content {
        padding: 20px;
      }
      
      .step-indicator {
        margin-bottom: 20px;
      }
      
      .step {
        width: 60px;
      }
      
      .step-circle {
        width: 28px;
        height: 28px;
        font-size: 0.9rem;
      }
      
      .step-label {
        font-size: 0.7rem;
      }
      
      .quick-amounts {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .navigation-btns {
        flex-direction: column;
      }
    }

    /* Toast */
    .wallet-toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(0, 102, 51, 0.9);
      color: white;
      padding: 12px 20px;
      border-radius: 10px;
      font-size: 14px;
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      max-width: 300px;
      direction: rtl;
    }
  </style>
</head>
<body>
  <!-- ØµÙØ­Ø© Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
  <div class="wallet-page">
    <div class="wallet-frame">
      <div class="wallet-header">
        <div class="wallet-brand">
          <div class="wallet-avatar">
            <div class="wallet-coin-icon" id="walletCoinIcon">ğŸ’°</div>
          </div>
          <div class="wallet-user-meta">
            <div class="name" id="walletUserName">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
            <div class="sub" id="walletUserId">id: ...</div>
          </div>
        </div>

        <div class="wallet-controls">
          <a href="https://t.me/Baridi_Mob_dz" target="_blank" class="wallet-channel-btn">
            Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ
          </a>
        </div>
      </div>

      <div class="wallet-content">
        <div class="wallet-balance-card">
          <div class="wallet-balance-left">
            <div class="wallet-bal-label">Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
            <div class="wallet-bal-amount" id="walletTotalBalance">0.00 Ø¯Ø¬</div>
          </div>
          <div class="wallet-bal-trend" id="walletTrend">+0.0%</div>
        </div>

        <div class="wallet-actions">
          <button class="wallet-send-btn" id="walletSendBtn">ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…ÙˆØ§Ù„</button>
          <button class="wallet-neon-btn" id="walletReceiveBtn">ğŸ“¥ Ø§Ø³ØªÙ„Ø§Ù… Ø£Ù…ÙˆØ§Ù„</button>
          <button class="wallet-exchange-btn" id="walletNetworkBtn">ğŸ”— Ø´Ø¨ÙƒØ© Ø§Ù„ØªØ¨Ø§Ø¯Ù„</button>
        </div>

        <div>
          <div class="wallet-section-title">Ù…Ø­ÙØ¸ØªÙŠ Ø§Ù„Ø¹Ù…Ù„Ø§Øª</div>
          <div class="wallet-wallets" id="walletWalletsList">
            <!-- Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
          </div>
        </div>

        <div class="wallet-smallnote">Â© 2025 â€” Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ© Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠØ©</div>
      </div>
    </div>

    <!-- Loading Spinner -->
    <div class="wallet-loading-spinner" id="walletLoadingSpinner">
      <div class="wallet-spinner"></div>
    </div>

    <!-- ========== Ù†Ø§ÙØ°Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ========== -->
    <div class="money-transfer-modal" id="moneyTransferModal">
      <div class="transfer-header">
        <button class="transfer-close-btn" id="transferCloseBtn">&times;</button>
        <h1>Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„</h1>
        <p>Ø£Ø±Ø³Ù„ Ø£Ù…ÙˆØ§Ù„Ùƒ Ø¨Ø³Ù‡ÙˆÙ„Ø© ÙˆØ£Ù…Ø§Ù†</p>
      </div>

      <div class="transfer-content">
        <div class="step-indicator">
          <div class="step active" id="step1Indicator">
            <div class="step-circle">1</div>
            <div class="step-label">Ø§Ù„Ù…Ø³ØªÙ„Ù…</div>
          </div>
          <div class="step" id="step2Indicator">
            <div class="step-circle">2</div>
            <div class="step-label">Ø§Ù„Ù…Ø¨Ù„Øº</div>
          </div>
          <div class="step" id="step3Indicator">
            <div class="step-circle">3</div>
            <div class="step-label">Ø§Ù„ØªØ£ÙƒÙŠØ¯</div>
          </div>
        </div>

        <div class="alert error" id="transferErrorAlert"></div>
        <div class="alert success" id="transferSuccessAlert"></div>

        <div class="step-content active" id="transferStep1">
          <div class="step-card">
            <div class="step-title">
              <i class="fas fa-user-friends"></i>
              Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…
            </div>
            
            <div class="form-group">
              <label class="form-label">Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªÙ„Ù… (ID)</label>
              <div class="input-with-icon">
                <input type="text" class="form-input" id="transferRecipientId" placeholder="Ø£Ø¯Ø®Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªÙ„Ù…">
                <i class="fas fa-user"></i>
              </div>
            </div>
            
            <div class="form-group">
              <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù… (Ø³ÙŠØ¸Ù‡Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)</label>
              <div class="input-with-icon">
                <input type="text" class="form-input" id="transferRecipientName" placeholder="Ø³ÙŠØ¸Ù‡Ø± Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹" readonly>
                <i class="fas fa-user-tag"></i>
              </div>
            </div>
          </div>
          
          <div class="balance-info">
            <span class="balance-label">Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ù…ØªØ§Ø­:</span>
            <span class="balance-amount" id="transferAvailableBalance">0.00 Ø¯Ø¬</span>
          </div>
        </div>

        <div class="step-content" id="transferStep2">
          <div class="step-card">
            <div class="step-title">
              <i class="fas fa-money-bill-wave"></i>
              Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¥Ø±Ø³Ø§Ù„Ù‡
            </div>
            
            <div class="form-group">
              <label class="form-label">Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…Ù„Ø©</label>
              <div class="currency-options">
                <button class="currency-btn active" data-currency="DZD">Ø§Ù„Ø¯ÙŠÙ†Ø§Ø± Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠ (Ø¯Ø¬)</button>
                <button class="currency-btn usd" data-currency="USD">Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠ ($)</button>
              </div>
            </div>
            
            <div class="form-group">
              <label class="form-label">Ø§Ù„Ù…Ø¨Ù„Øº</label>
              <div class="input-with-icon">
                <input type="number" class="form-input" id="transferAmount" placeholder="0.00" step="0.01" min="0">
                <i class="fas fa-money-bill"></i>
              </div>
            </div>
            
            <div class="quick-amounts">
              <button class="amount-btn" data-amount="1000">1,000</button>
              <button class="amount-btn" data-amount="5000">5,000</button>
              <button class="amount-btn" data-amount="10000">10,000</button>
              <button class="amount-btn" data-amount="50000">50,000</button>
            </div>
            
            <div class="form-group">
              <label class="form-label">ÙˆØµÙ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
              <textarea class="form-input" id="transferDescription" placeholder="Ù…Ø«Ø§Ù„: Ø¯ÙØ¹ ÙØ§ØªÙˆØ±Ø© Ø£Ùˆ Ù‡Ø¯ÙŠØ©" rows="3"></textarea>
            </div>
          </div>
          
          <div class="balance-info">
            <span class="balance-label">Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ù…ØªØ§Ø­:</span>
            <span class="balance-amount" id="transferAvailableBalance2">0.00 Ø¯Ø¬</span>
          </div>
        </div>

        <div class="step-content" id="transferStep3">
          <div class="step-card">
            <div class="step-title">
              <i class="fas fa-check-circle"></i>
              ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©
            </div>
            
            <p style="margin-bottom: 20px; color: var(--text-gray);">ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ù‚Ø¨Ù„ Ø§Ù„ØªØ£ÙƒÙŠØ¯</p>
            
            <div class="transaction-details">
              <div class="detail-row">
                <span class="detail-label">Ø§Ù„Ù…Ø³ØªÙ„Ù…:</span>
                <span class="detail-value" id="confirmRecipientName">-</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªÙ„Ù…:</span>
                <span class="detail-value" id="confirmRecipientId">-</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Ø§Ù„Ù…Ø¨Ù„Øº:</span>
                <span class="detail-value" id="confirmAmount">-</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Ø§Ù„ÙˆØµÙ:</span>
                <span class="detail-value" id="confirmDescription">Ù„Ø§ ÙŠÙˆØ¬Ø¯</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Ø±Ø³ÙˆÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„:</span>
                <span class="detail-value" id="confirmFees">0.00 Ø¯Ø¬</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
                <span class="detail-value" id="confirmTotal">-</span>
              </div>
            </div>
          </div>
        </div>

        <div class="success-screen" id="transferSuccessScreen">
          <div class="success-icon">
            <i class="fas fa-check"></i>
          </div>
          
          <h2 class="success-title">ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­!</h2>
          <p class="success-message" id="transferSuccessMessage">
            ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙ„Ù….<br>
            Ø³ØªØ¸Ù‡Ø± Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© ÙÙŠ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª.
          </p>
          
          <div class="transaction-details">
            <div class="detail-row">
              <span class="detail-label">Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ©:</span>
              <span class="detail-value" id="transferTransactionId">TRX-001</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª:</span>
              <span class="detail-value" id="transferTransactionTime">-</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ©:</span>
              <span class="detail-value" style="color: var(--success);">Ù…ÙƒØªÙ…Ù„Ø©</span>
            </div>
          </div>
          
          <div class="navigation-btns" style="margin-top: 30px;">
            <button class="nav-btn back" id="newTransferBtn">
              <i class="fas fa-paper-plane"></i>
              Ø¥Ø±Ø³Ø§Ù„ Ø¬Ø¯ÙŠØ¯Ø©
            </button>
          </div>
        </div>

        <div class="navigation-btns" id="transferNavigationBtns">
          <button class="nav-btn back" id="transferPrevBtn" style="display: none;">
            <i class="fas fa-arrow-right"></i>
            Ø±Ø¬ÙˆØ¹
          </button>
          <button class="nav-btn next" id="transferNextBtn">
            Ø§Ù„ØªØ§Ù„ÙŠ
            <i class="fas fa-arrow-left"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- ========== Ù†Ø§ÙØ°Ø© Ø´Ø¨ÙƒØ© Ø§Ù„ØªØ¨Ø§Ø¯Ù„ ========== -->
    <div class="exchange-modal" id="exchangeModal">
      <div class="exchange-header">
        <button class="exchange-close-btn" id="exchangeCloseBtn">&times;</button>
        <div>
          <h1 class="exchange-title">Ù…Ù†ØµØ© ØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª</h1>
          <p class="exchange-subtitle">ØªØ¨Ø§Ø¯Ù„ Ø³Ø±ÙŠØ¹ Ù„Ù„Ø¹Ù…Ù„Ø§Øª Ø¨ÙŠÙ† Ø§Ù„Ø£ÙØ±Ø§Ø¯ Ù…Ø¨Ø§Ø´Ø±Ø©</p>
        </div>
      </div>

      <div class="exchange-filters">
        <button class="exchange-filter-btn active" data-filter="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
        <button class="exchange-filter-btn" data-filter="sell-dzd">Ø¨ÙŠØ¹ Ø¯ÙŠÙ†Ø§Ø±</button>
        <button class="exchange-filter-btn" data-filter="sell-usd">Ø¨ÙŠØ¹ Ø¯ÙˆÙ„Ø§Ø±</button>
      </div>

      <div class="exchange-container" id="exchangeContainer">
        <!-- Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
      </div>

      <button class="exchange-create-btn" id="exchangeCreateBtn">
        <i class="fas fa-plus"></i>
      </button>

      <div class="exchange-footer">
        <p><i class="fas fa-info-circle"></i> Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ù„ØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ù…Ø¹ Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø± Ø¨Ø£Ù…Ø§Ù†.</p>
      </div>
    </div>

    <!-- ========== Ù†Ø§ÙØ°Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ ØªØ¨Ø§Ø¯Ù„ Ø¬Ø¯ÙŠØ¯ ========== -->
    <div class="create-exchange-modal" id="createExchangeModal">
      <div class="create-exchange-header">
        <button class="create-exchange-close-btn" id="createExchangeCloseBtn">&times;</button>
        <div>
          <h1 class="exchange-title">Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ ØªØ¨Ø§Ø¯Ù„ Ø¬Ø¯ÙŠØ¯</h1>
          <p class="exchange-subtitle">Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ù„ØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ù…Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†</p>
        </div>
      </div>

      <div class="create-exchange-form">
        <div class="balance-info">
          <div>Ø±ØµÙŠØ¯ Ø§Ù„Ø¯ÙŠÙ†Ø§Ø± Ø§Ù„Ù…ØªÙˆÙØ±: <span id="availableDZD">0.00 Ø¯Ø¬</span></div>
          <div>Ø±ØµÙŠØ¯ Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ø§Ù„Ù…ØªÙˆÙØ±: <span id="availableUSD">0.00 $</span></div>
        </div>

        <div class="form-group">
          <label class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨</label>
          <select class="form-select" id="exchangeType">
            <option value="sell-dzd">Ø¨ÙŠØ¹ Ø¯ÙŠÙ†Ø§Ø± Ù…Ù‚Ø§Ø¨Ù„ Ø¯ÙˆÙ„Ø§Ø±</option>
            <option value="sell-usd">Ø¨ÙŠØ¹ Ø¯ÙˆÙ„Ø§Ø± Ù…Ù‚Ø§Ø¨Ù„ Ø¯ÙŠÙ†Ø§Ø±</option>
          </select>
        </div>

        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
          <div style="flex: 1;">
            <label class="form-label">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø°ÙŠ ØªØ¨ÙŠØ¹Ù‡</label>
            <input type="number" class="form-input" id="sellAmount" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº" step="0.01" min="0.01">
          </div>
          <div style="flex: 1;">
            <label class="form-label">Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù</label>
            <input type="number" class="form-input" id="exchangeRate" placeholder="Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù" step="0.01" min="0.01">
          </div>
        </div>

        <div class="form-group" style="margin-top: 20px;">
          <div style="background: var(--bg-lighter); padding: 15px; border-radius: 10px; border: 1px solid var(--border-light);">
            <div style="font-size: 14px; color: var(--text-dark); font-weight: 600; margin-bottom: 5px;">Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨:</div>
            <div style="font-size: 13px; color: var(--text-gray);">
              <div>Ø§Ù„Ù…Ø¨Ù„Øº: <span id="summaryAmount">0</span></div>
              <div>Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù: <span id="summaryRate">0</span></div>
              <div>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="summaryTotal">0</span></div>
            </div>
          </div>
        </div>

        <div style="display:flex;gap:10px;margin-top:20px;">
          <button id="createExchangeSubmit" class="wallet-neon-btn" style="flex:1;padding:12px;">
            <i class="fas fa-check-circle"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨
          </button>
          <button id="createExchangeCancel" class="wallet-ghost-btn" style="flex:1;padding:12px;">
            <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
          </button>
        </div>
      </div>
    </div>

    <!-- ========== Ù†Ø§ÙØ°Ø© Ø­ÙˆØ§Ø± ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ¨Ø§Ø¯Ù„ ========== -->
    <div class="exchange-dialog" id="exchangeDialog">
      <div class="exchange-dialog-content">
        <div class="exchange-dialog-header">
          <div class="exchange-dialog-title">
            <i class="fas fa-handshake"></i>
            ØªØ£ÙƒÙŠØ¯ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ¨Ø§Ø¯Ù„
          </div>
          <button class="exchange-dialog-close" id="exchangeDialogClose">&times;</button>
        </div>
        
        <div class="exchange-dialog-message" id="exchangeDialogMessage">
          <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
        </div>
        
        <div class="exchange-dialog-details">
          <div class="exchange-dialog-item">
            <span class="exchange-dialog-label">Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</span>
            <span class="exchange-dialog-value" id="exchangeTransactionId">TRX-001</span>
          </div>
          <div class="exchange-dialog-item">
            <span class="exchange-dialog-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</span>
            <span class="exchange-dialog-value" id="exchangeTransactionDate">--/--/---- --:--</span>
          </div>
          <div class="exchange-dialog-item">
            <span class="exchange-dialog-label">Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</span>
            <span class="exchange-dialog-value">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯</span>
          </div>
        </div>
        
        <div class="exchange-dialog-actions">
          <button class="exchange-dialog-btn cancel" id="exchangeDialogCancel">
            <i class="fas fa-times"></i>
            Ø¥Ù„ØºØ§Ø¡
          </button>
          <button class="exchange-dialog-btn confirm" id="exchangeDialogConfirm">
            <i class="fas fa-check"></i>
            ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ¨Ø§Ø¯Ù„
          </button>
        </div>
      </div>
    </div>

    <!-- ========== Ù†Ø§ÙØ°Ø© Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø£Ù…ÙˆØ§Ù„ ========== -->
    <div class="receive-modal" id="walletReceiveModal">
      <div class="receive-header">
        <button class="receive-close-btn" id="receiveCloseBtn">&times;</button>
        <div>
          <h1 class="receive-title">Ù†Ø¸Ø§Ù… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª</h1>
          <p class="receive-subtitle">Ø´Ø§Ø±Ùƒ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ Ø¨Ø³Ù‡ÙˆÙ„Ø© ÙˆØ£Ù…Ø§Ù†</p>
        </div>
      </div>

      <div class="receive-content">
        <div class="receive-grid">
          <!-- Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø«Ø§Ø¨ØªØ© -->
          <div class="bank-card">
            <div class="bank-icon-container">
              <div class="bank-icon">
                <i class="fas fa-university"></i>
              </div>
            </div>
            
            <div class="bank-card-title">
              <i class="fas fa-id-card"></i>
              Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø«Ø§Ø¨ØªØ©
            </div>
            
            <div class="bank-info-container">
              <div class="bank-info-header">
                <span class="bank-badge">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ø·Ù„ÙˆØ¨Ø©</span>
                <span class="bank-info-label">Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙ (ID)</span>
              </div>
              <div class="bank-info-box">
                <div class="bank-info-value" id="bankUserId">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                <button class="bank-copy-btn" id="bankCopyIdBtn">
                  <i class="far fa-copy"></i>
                  Ù†Ø³Ø® Ø§Ù„Ø±Ù‚Ù…
                </button>
              </div>
              <div class="bank-hint">
                <i class="fas fa-info-circle"></i>
                Ø±Ù‚Ù… id Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ø£Ø±Ø³Ù„Ù‡ Ù„ØµØ¯ÙŠÙ‚Ùƒ Ù„ÙŠÙ‚ÙˆÙ… Ø¨ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ Ø¥Ù„ÙŠÙƒ
              </div>
            </div>
            
            <div class="bank-info-container">
              <div class="bank-info-header">
                <span class="bank-badge baridi">BaridiMob</span>
                <span class="bank-info-label">Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨</span>
              </div>
              <div class="bank-info-box">
                <div class="bank-info-value" id="bankAccountNumber">079999900238685859563</div>
                <button class="bank-copy-btn" id="bankCopyAccountBtn">
                  <i class="far fa-copy"></i>
                  Ù†Ø³Ø® Ø§Ù„Ø±Ù‚Ù…
                </button>
              </div>
              <div class="bank-hint">
                <i class="fas fa-info-circle"></i>
                Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø®ØµØµ Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª Ù…Ù† Ø¨Ø±ÙŠØ¯ÙŠ Ù…ÙˆØ¨ ÙÙ‚Ø·
              </div>
            </div>
            
            <div class="bank-info-container">
              <div class="bank-info-header">
                <span class="bank-badge binance">Binance</span>
                <span class="bank-info-label">Ø±Ù‚Ù… ØªØ¹Ø±ÙŠÙ</span>
              </div>
              <div class="bank-info-box">
                <div class="bank-info-value" id="bankBinanceId">1143951718</div>
                <button class="bank-copy-btn" id="bankCopyBinanceBtn">
                  <i class="far fa-copy"></i>
                  Ù†Ø³Ø® Ø§Ù„Ø±Ù‚Ù…
                </button>
              </div>
              <div class="bank-hint">
                <i class="fas fa-info-circle"></i>
                Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø±Ù Ø§Ù„Ø®Ø§Øµ Ø¨Ø­Ø³Ø§Ø¨ Ø¨ÙŠÙ†Ø§Ù†Ø³ Ù„Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ©
              </div>
            </div>
          </div>
          
          <!-- Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ­ÙˆÙŠÙ„ -->
          <div class="bank-card">
            <div class="bank-card-title">
              <i class="fas fa-credit-card"></i>
              ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙˆØ§Ø±Ø¯
            </div>
            
            <div class="bank-form-container">
              <div class="bank-form-group">
                <label class="bank-form-label" for="bankTransferType">
                  <i class="fas fa-exchange-alt"></i>
                  Ù†ÙˆØ¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„
                </label>
                <select id="bankTransferType" class="bank-form-select">
                  <option value="bank">ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</option>
                  <option value="binance">ØªØ­ÙˆÙŠÙ„ Ø¹Ø¨Ø± Ø¨ÙŠÙ†Ø§Ù†Ø³</option>
                </select>
                <div class="bank-hint">
                  <i class="fas fa-info-circle"></i>
                  Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
                </div>
              </div>
              
              <div class="bank-form-group">
                <label class="bank-form-label" for="bankTransactionNumber">
                  <i class="fas fa-receipt"></i>
                  Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©
                </label>
                <input type="text" id="bankTransactionNumber" class="bank-form-input" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© ÙƒÙ…Ø§ ÙˆØ±Ø¯ ÙÙŠ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±">
                <div class="bank-hint">
                  <i class="fas fa-info-circle"></i>
                  ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© ÙÙŠ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¨Ù†Ùƒ Ø£Ùˆ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ­ÙˆÙŠÙ„
                </div>
              </div>
              
              <div class="bank-form-group">
                <label class="bank-form-label" for="bankAmount">
                  <i class="fas fa-money-bill-wave"></i>
                  Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø­ÙˆÙ„
                </label>
                <div class="bank-amount-container">
                  <input type="text" id="bankAmount" class="bank-form-input" placeholder="0.00">
                  <div class="bank-currency-symbol" id="bankCurrencySymbol">DZD</div>
                </div>
                <div class="bank-hint">
                  <i class="fas fa-info-circle"></i>
                  <span id="bankCurrencyHint">Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ø¯ÙŠÙ†Ø§Ø± Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠ (Ù…Ø«Ø§Ù„: 150000.50)</span>
                </div>
              </div>
              
              <button class="bank-submit-btn" id="bankSubmitBtn">
                <i class="fas fa-paper-plane"></i>
                ØªØ£ÙƒÙŠØ¯ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
              </button>
              
              <div class="bank-success-animation" id="bankSuccessAnimation">
                <i class="fas fa-check-circle"></i>
                <p>ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ========== Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù†Ø³Ø® ========== -->
    <div class="bank-notification" id="bankNotification">
      <i class="fas fa-check-circle"></i>
      <span id="bankNotificationText">ØªÙ… Ø§Ù„Ù†Ø³Ø® Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø© Ø¨Ù†Ø¬Ø§Ø­</span>
    </div>
  </div>

  <script>
    // ========== ØªÙ‡ÙŠØ¦Ø© Firebase ==========
    const firebaseConfig = {
      apiKey: "AIzaSyBX8v0qIVjG-Z46fVDeEUDKcPxa_FQF9Qc",
      authDomain: "bnak-belaiba.firebaseapp.com",
      projectId: "bnak-belaiba",
      storageBucket: "bnak-belaiba.firebasestorage.app",
      messagingSenderId: "286736432059",
      appId: "1:286736432059:web:ec1ed4292850f00008229e"
    };

    let db;
    let firebaseApp;
    let currentExchangeOrderId = null;

    try {
      firebaseApp = firebase.initializeApp(firebaseConfig);
      db = firebase.firestore(firebaseApp);
      console.log('âœ… Firebase initialized successfully');
    } catch (error) {
      console.error('âŒ Firebase initialization error:', error);
      showToast('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
    }

    // ========== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ==========
    let currentUser = {
      id: null,
      firstName: 'Ù…Ø³ØªØ®Ø¯Ù…',
      lastName: '',
      username: null
    };

    let userBalances = {
      'DZD': 0.00,
      'USD': 0.00
    };

    let exchangeRates = {
      'USD_DZD': 134.5,
      'DZD_USD': 0.0074
    };

    let transferData = {
      currentStep: 1,
      recipient: {
        id: '',
        name: ''
      },
      amount: 0,
      currency: 'DZD',
      description: '',
      transactionId: generateTransactionId()
    };

    let activeExchangeOrders = [];
    let userUnsubscribe = null;
    let exchangeUnsubscribe = null;

    // ========== Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ==========
    function showToast(message, type = 'info') {
      const existingToasts = document.querySelectorAll('.wallet-toast');
      existingToasts.forEach(toast => toast.remove());
      
      const toast = document.createElement('div');
      toast.className = `wallet-toast`;
      toast.textContent = message;
      
      if (type === 'error') {
        toast.style.background = 'rgba(239, 68, 68, 0.9)';
      } else if (type === 'warning') {
        toast.style.background = 'rgba(245, 158, 11, 0.9)';
      } else if (type === 'success') {
        toast.style.background = 'rgba(34, 197, 94, 0.9)';
      }
      
      document.body.appendChild(toast);
      
      setTimeout(() => {
        if (toast.parentNode) {
          toast.style.opacity = '0';
          toast.style.transition = 'opacity 0.3s ease';
          setTimeout(() => {
            if (toast.parentNode) {
              toast.remove();
            }
          }, 300);
        }
      }, 3000);
    }

    function showWalletLoading() {
      document.getElementById('walletLoadingSpinner').style.display = 'flex';
    }

    function hideWalletLoading() {
      document.getElementById('walletLoadingSpinner').style.display = 'none';
    }

    // ========== Ø¯ÙˆØ§Ù„ Firebase ==========
    async function saveUserToFirebase(userData) {
      try {
        if (!db) throw new Error('Firebase ØºÙŠØ± Ù…Ù‡ÙŠØ¦');
        
        const userRef = db.collection('users').doc(userData.id.toString());
        const userDoc = await userRef.get();
        
        if (!userDoc.exists) {
          await userRef.set({
            id: userData.id,
            firstName: userData.first_name || userData.firstName,
            lastName: userData.last_name || userData.lastName || '',
            username: userData.username,
            balances: {
              DZD: 10000.00,
              USD: 100.00
            },
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            lastLogin: firebase.firestore.FieldValue.serverTimestamp()
          });
          console.log('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯:', userData.id);
        } else {
          await userRef.update({
            lastLogin: firebase.firestore.FieldValue.serverTimestamp()
          });
        }
        
        return true;
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
        return false;
      }
    }

    async function getUserFromFirebase(userId) {
      try {
        if (!db) throw new Error('Firebase ØºÙŠØ± Ù…Ù‡ÙŠØ¦');
        
        const userRef = db.collection('users').doc(userId.toString());
        const userDoc = await userRef.get();
        
        if (userDoc.exists) {
          return userDoc.data();
        } else {
          return null;
        }
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
        return null;
      }
    }

    async function updateUserBalance(userId, currency, amount, isAdd = true) {
      try {
        if (!db) throw new Error('Firebase ØºÙŠØ± Ù…Ù‡ÙŠØ¦');
        
        const userRef = db.collection('users').doc(userId.toString());
        const userDoc = await userRef.get();
        
        if (!userDoc.exists) {
          throw new Error('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
        }
        
        const userData = userDoc.data();
        const currentBalance = userData.balances?.[currency] || 0;
        const newBalance = isAdd ? currentBalance + amount : currentBalance - amount;
        
        if (newBalance < 0) {
          throw new Error('Ø§Ù„Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙŠ');
        }
        
        await userRef.update({
          [`balances.${currency}`]: newBalance
        });
        
        return newBalance;
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ØµÙŠØ¯:', error);
        throw error;
      }
    }

    async function transferMoney(senderId, receiverId, currency, amount, description = '') {
      try {
        showWalletLoading();
        
        await updateUserBalance(senderId, currency, amount, false);
        await updateUserBalance(receiverId, currency, amount, true);
        
        const transactionRef = db.collection('transactions').doc();
        await transactionRef.set({
          id: transactionRef.id,
          senderId: senderId,
          receiverId: receiverId,
          currency: currency,
          amount: amount,
          description: description,
          type: 'transfer',
          status: 'completed',
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        showToast(`âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ${amount} ${currency} Ø¨Ù†Ø¬Ø§Ø­`, 'success');
        return transactionRef.id;
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„:', error);
        showToast(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„: ${error.message}`, 'error');
        return null;
      } finally {
        hideWalletLoading();
      }
    }

    async function createExchangeOrder(userId, type, sellAmount, exchangeRate) {
      try {
        showWalletLoading();
        
        const sellCurrency = type === 'sell-usd' ? 'USD' : 'DZD';
        const receiveCurrency = type === 'sell-usd' ? 'DZD' : 'USD';
        
        const userData = await getUserFromFirebase(userId);
        if (!userData || (userData.balances?.[sellCurrency] || 0) < sellAmount) {
          throw new Error('Ø§Ù„Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙŠ');
        }
        
        await updateUserBalance(userId, sellCurrency, sellAmount, false);
        
        const orderRef = db.collection('exchange_orders').doc();
        const orderData = {
          id: orderRef.id,
          userId: userId,
          userName: userData.firstName || 'Ù…Ø³ØªØ®Ø¯Ù…',
          type: type,
          sellCurrency: sellCurrency,
          sellAmount: sellAmount,
          receiveCurrency: receiveCurrency,
          exchangeRate: exchangeRate,
          status: 'active',
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        await orderRef.set(orderData);
        
        showToast('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø§Ø¯Ù„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        return orderRef.id;
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø§Ø¯Ù„:', error);
        showToast(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø§Ø¯Ù„: ${error.message}`, 'error');
        return null;
      } finally {
        hideWalletLoading();
      }
    }

    async function executeExchange(orderId, buyerId) {
      try {
        showWalletLoading();
        
        const orderRef = db.collection('exchange_orders').doc(orderId);
        const orderDoc = await orderRef.get();
        
        if (!orderDoc.exists) {
          throw new Error('Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø§Ø¯Ù„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
        }
        
        const order = orderDoc.data();
        
        if (order.status !== 'active') {
          throw new Error('Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø§Ø¯Ù„ ØºÙŠØ± Ù…ØªØ§Ø­');
        }
        
        if (order.userId === buyerId) {
          throw new Error('Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ¨Ø§Ø¯Ù„ Ù…Ø¹ Ù†ÙØ³Ùƒ');
        }
        
        let buyerSellAmount, buyerReceiveAmount, sellerReceiveAmount;
        
        if (order.type === 'sell-usd') {
          buyerSellAmount = order.sellAmount * order.exchangeRate;
          buyerReceiveAmount = order.sellAmount;
          sellerReceiveAmount = buyerSellAmount;
        } else {
          buyerSellAmount = order.sellAmount / order.exchangeRate;
          buyerReceiveAmount = order.sellAmount;
          sellerReceiveAmount = buyerSellAmount;
        }
        
        const buyerData = await getUserFromFirebase(buyerId);
        if (!buyerData) {
          throw new Error('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´ØªØ±ÙŠ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©');
        }
        
        const buyerCurrency = order.type === 'sell-usd' ? 'DZD' : 'USD';
        if ((buyerData.balances?.[buyerCurrency] || 0) < buyerSellAmount) {
          throw new Error('Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø´ØªØ±ÙŠ ØºÙŠØ± ÙƒØ§ÙÙŠ');
        }
        
        const batch = db.batch();
        
        const buyerRef = db.collection('users').doc(buyerId.toString());
        const buyerCurrentBalance = buyerData.balances?.[buyerCurrency] || 0;
        batch.update(buyerRef, {
          [`balances.${buyerCurrency}`]: buyerCurrentBalance - buyerSellAmount
        });
        
        const buyerReceiveCurrency = order.type === 'sell-usd' ? 'USD' : 'DZD';
        const buyerCurrentReceiveBalance = buyerData.balances?.[buyerReceiveCurrency] || 0;
        batch.update(buyerRef, {
          [`balances.${buyerReceiveCurrency}`]: buyerCurrentReceiveBalance + buyerReceiveAmount
        });
        
        const sellerRef = db.collection('users').doc(order.userId.toString());
        const sellerData = await sellerRef.get();
        const sellerCurrentBalance = sellerData.data()?.balances?.[order.sellCurrency] || 0;
        batch.update(sellerRef, {
          [`balances.${order.sellCurrency}`]: sellerCurrentBalance + sellerReceiveAmount
        });
        
        batch.update(orderRef, {
          status: 'completed',
          buyerId: buyerId,
          buyerName: buyerData.firstName || 'Ù…Ø´ØªØ±ÙŠ',
          completedAt: firebase.firestore.FieldValue.serverTimestamp(),
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        const transactionRef = db.collection('transactions').doc();
        batch.set(transactionRef, {
          id: transactionRef.id,
          orderId: orderId,
          sellerId: order.userId,
          buyerId: buyerId,
          sellerCurrency: order.sellCurrency,
          sellerAmount: order.sellAmount,
          buyerCurrency: buyerCurrency,
          buyerAmount: buyerSellAmount,
          exchangeRate: order.exchangeRate,
          type: 'exchange',
          status: 'completed',
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        await batch.commit();
        
        showToast('âœ… ØªÙ… Ø¥ØªÙ…Ø§Ù… Ø§Ù„ØªØ¨Ø§Ø¯Ù„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        return true;
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ†ÙÙŠØ° Ø§Ù„ØªØ¨Ø§Ø¯Ù„:', error);
        showToast(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ¨Ø§Ø¯Ù„: ${error.message}`, 'error');
        return false;
      } finally {
        hideWalletLoading();
      }
    }

    async function cancelExchangeOrder(orderId, userId) {
      try {
        showWalletLoading();
        
        const orderRef = db.collection('exchange_orders').doc(orderId);
        const orderDoc = await orderRef.get();
        
        if (!orderDoc.exists) {
          throw new Error('Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø§Ø¯Ù„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
        }
        
        const order = orderDoc.data();
        
        if (order.userId !== userId) {
          throw new Error('Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ù„ØºØ§Ø¡ Ø·Ù„Ø¨ Ù„ÙŠØ³ Ù„Ùƒ');
        }
        
        if (order.status !== 'active') {
          throw new Error('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ù„ØºØ§Ø¡ Ø·Ù„Ø¨ ØºÙŠØ± Ù†Ø´Ø·');
        }
        
        await updateUserBalance(userId, order.sellCurrency, order.sellAmount, true);
        
        await orderRef.update({
          status: 'cancelled',
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        showToast('âœ… ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø§Ø¯Ù„', 'success');
        return true;
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù„ØºØ§Ø¡ Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø§Ø¯Ù„:', error);
        showToast(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ù„ØºØ§Ø¡: ${error.message}`, 'error');
        return false;
      } finally {
        hideWalletLoading();
      }
    }

    // ========== Ø¯ÙˆØ§Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ==========
    function setupRealtimeUserListener(userId) {
      if (userUnsubscribe) {
        userUnsubscribe();
      }
      
      userUnsubscribe = db.collection('users').doc(userId.toString())
        .onSnapshot((doc) => {
          if (doc.exists) {
            const userData = doc.data();
            updateUserInterface(userData);
            
            if (userData.balances) {
              userBalances.DZD = userData.balances.DZD || 0;
              userBalances.USD = userData.balances.USD || 0;
              
              updateWalletsListRealTime();
              updateTotalBalance();
              updateTransferBalanceDisplay();
              updateAvailableBalances();
            }
          }
        }, (error) => {
          console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
        });
    }

    function setupRealtimeExchangeListener() {
      if (exchangeUnsubscribe) {
        exchangeUnsubscribe();
      }
      
      exchangeUnsubscribe = db.collection('exchange_orders')
        .where('status', '==', 'active')
        .orderBy('createdAt', 'desc')
        .onSnapshot((snapshot) => {
          activeExchangeOrders = [];
          snapshot.forEach((doc) => {
            const order = doc.data();
            order.createdAt = order.createdAt?.toDate() || new Date();
            activeExchangeOrders.push(order);
          });
          
          renderExchangeCards();
        }, (error) => {
          console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„ØªØ¨Ø§Ø¯Ù„:', error);
        });
    }

    // ========== Ø¯ÙˆØ§Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ ==========
    function openMoneyTransferModal() {
      document.getElementById('moneyTransferModal').classList.add('open');
      updateTransferBalanceDisplay();
    }

    function closeMoneyTransferModal() {
      document.getElementById('moneyTransferModal').classList.remove('open');
      resetTransferForm();
    }

    function updateTransferBalanceDisplay() {
      const currencySymbol = transferData.currency === 'DZD' ? 'Ø¯Ø¬' : '$';
      const balance = userBalances[transferData.currency] || 0;
      const balanceText = `${balance.toFixed(2)} ${currencySymbol}`;
      
      document.getElementById('transferAvailableBalance').textContent = balanceText;
      document.getElementById('transferAvailableBalance2').textContent = balanceText;
    }

    function resetTransferForm() {
      transferData = {
        currentStep: 1,
        recipient: {
          id: '',
          name: ''
        },
        amount: 0,
        currency: 'DZD',
        description: '',
        transactionId: generateTransactionId()
      };
      
      document.querySelectorAll('.step-content').forEach((content, index) => {
        content.classList.remove('active');
        if (index === 0) content.classList.add('active');
      });
      
      document.querySelectorAll('.step').forEach((indicator, index) => {
        indicator.classList.remove('active', 'completed');
        if (index === 0) indicator.classList.add('active');
      });
      
      document.getElementById('transferRecipientId').value = '';
      document.getElementById('transferRecipientName').value = '';
      document.getElementById('transferAmount').value = '';
      document.getElementById('transferDescription').value = '';
      
      document.querySelectorAll('.currency-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.currency === 'DZD') btn.classList.add('active');
      });
      
      document.getElementById('transferNextBtn').textContent = 'Ø§Ù„ØªØ§Ù„ÙŠ';
      document.getElementById('transferNextBtn').classList.remove('confirm');
      document.getElementById('transferNextBtn').classList.add('next');
      document.getElementById('transferPrevBtn').style.display = 'none';
      document.getElementById('transferSuccessScreen').style.display = 'none';
      document.getElementById('transferNavigationBtns').style.display = 'flex';
      
      hideTransferAlerts();
      updateTransferBalanceDisplay();
    }

    async function goToNextTransferStep() {
      if (!validateCurrentTransferStep()) return;
      
      if (transferData.currentStep < 3) {
        document.querySelectorAll('.step-content').forEach(content => content.classList.remove('active'));
        document.querySelectorAll('.step').forEach(indicator => indicator.classList.remove('active'));
        
        transferData.currentStep++;
        
        document.getElementById(`transferStep${transferData.currentStep}`).classList.add('active');
        document.getElementById(`step${transferData.currentStep}Indicator`).classList.add('active');
        
        if (transferData.currentStep === 3) {
          document.getElementById('transferNextBtn').textContent = 'ØªØ£ÙƒÙŠØ¯ ÙˆØ¥Ø±Ø³Ø§Ù„';
          document.getElementById('transferNextBtn').classList.remove('next');
          document.getElementById('transferNextBtn').classList.add('confirm');
          updateTransferConfirmationPage();
        }
        
        document.getElementById('transferPrevBtn').style.display = 'flex';
        hideTransferAlerts();
      } else {
        await confirmTransfer();
      }
    }

    function goToPreviousTransferStep() {
      document.querySelectorAll('.step-content').forEach(content => content.classList.remove('active'));
      document.querySelectorAll('.step').forEach(indicator => indicator.classList.remove('active'));
      
      transferData.currentStep--;
      
      document.getElementById(`transferStep${transferData.currentStep}`).classList.add('active');
      document.getElementById(`step${transferData.currentStep}Indicator`).classList.add('active');
      
      if (transferData.currentStep === 2) {
        document.getElementById('transferNextBtn').textContent = 'Ø§Ù„ØªØ§Ù„ÙŠ';
        document.getElementById('transferNextBtn').classList.remove('confirm');
        document.getElementById('transferNextBtn').classList.add('next');
      }
      
      if (transferData.currentStep === 1) {
        document.getElementById('transferPrevBtn').style.display = 'none';
      }
      
      hideTransferAlerts();
    }

    function validateCurrentTransferStep() {
      switch (transferData.currentStep) {
        case 1:
          return validateTransferStep1();
        case 2:
          return validateTransferStep2();
        case 3:
          return true;
        default:
          return false;
      }
    }

    async function validateTransferStep1() {
      const recipientId = document.getElementById('transferRecipientId').value.trim();
      
      if (!recipientId) {
        showTransferError('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªÙ„Ù…');
        return false;
      }
      
      if (recipientId === currentUser.id.toString()) {
        showTransferError('Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…ÙˆØ§Ù„ Ù„Ù†ÙØ³Ùƒ');
        return false;
      }
      
      try {
        const recipientData = await getUserFromFirebase(recipientId);
        
        if (!recipientData) {
          showTransferError('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
          return false;
        }
        
        transferData.recipient.id = recipientId;
        transferData.recipient.name = recipientData.firstName || 'Ù…Ø³ØªØ®Ø¯Ù…';
        
        document.getElementById('transferRecipientName').value = transferData.recipient.name;
        
        return true;
      } catch (error) {
        showTransferError('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
        return false;
      }
    }

    function validateTransferStep2() {
      const amount = parseFloat(document.getElementById('transferAmount').value) || 0;
      const minAmount = transferData.currency === 'DZD' ? 10 : 1;
      const maxAmount = transferData.currency === 'DZD' ? 50000 : 1000;
      const userBalance = userBalances[transferData.currency] || 0;
      
      if (!amount || amount <= 0) {
        showTransferError('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­');
        return false;
      }
      
      if (amount < minAmount) {
        showTransferError(`Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø¥Ø±Ø³Ø§Ù„ Ù‡Ùˆ ${minAmount} ${transferData.currency === 'DZD' ? 'Ø¯Ø¬' : '$'}`);
        return false;
      }
      
      if (amount > maxAmount) {
        showTransferError(`Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø¥Ø±Ø³Ø§Ù„ Ù‡Ùˆ ${maxAmount} ${transferData.currency === 'DZD' ? 'Ø¯Ø¬' : '$'}`);
        return false;
      }
      
      if (amount > userBalance) {
        showTransferError('Ø±ØµÙŠØ¯Ùƒ ØºÙŠØ± ÙƒØ§ÙÙŠ Ù„Ø¥ÙƒÙ…Ø§Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©');
        return false;
      }
      
      transferData.amount = amount;
      transferData.description = document.getElementById('transferDescription').value.trim();
      
      return true;
    }

    function updateTransferConfirmationPage() {
      document.getElementById('confirmRecipientName').textContent = transferData.recipient.name;
      document.getElementById('confirmRecipientId').textContent = transferData.recipient.id;
      
      const currencySymbol = transferData.currency === 'DZD' ? 'Ø¯Ø¬' : '$';
      const fees = calculateTransferFees(transferData.amount, transferData.currency);
      const total = transferData.amount + fees;
      
      document.getElementById('confirmAmount').textContent = `${transferData.amount.toFixed(2)} ${currencySymbol}`;
      document.getElementById('confirmDescription').textContent = transferData.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯';
      document.getElementById('confirmFees').textContent = `${fees.toFixed(2)} ${currencySymbol}`;
      document.getElementById('confirmTotal').textContent = `${total.toFixed(2)} ${currencySymbol}`;
    }

    function calculateTransferFees(amount, currency) {
      if (currency === 'DZD') {
        return amount <= 10000 ? 50 : 100;
      } else {
        return amount <= 100 ? 1 : 2;
      }
    }

    async function confirmTransfer() {
      try {
        showTransferSuccess('Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨Ùƒ...');
        
        const transactionId = await transferMoney(
          currentUser.id,
          transferData.recipient.id,
          transferData.currency,
          transferData.amount,
          transferData.description
        );
        
        if (transactionId) {
          document.querySelectorAll('.step-content').forEach(content => {
            content.style.display = 'none';
          });
          document.getElementById('transferNavigationBtns').style.display = 'none';
          
          document.getElementById('transferTransactionId').textContent = transactionId;
          document.getElementById('transferTransactionTime').textContent = new Date().toLocaleString('ar-EG', {
            dateStyle: 'medium',
            timeStyle: 'short'
          });
          
          document.getElementById('transferSuccessMessage').innerHTML = `
            ØªÙ… Ø¥Ø±Ø³Ø§Ù„ <strong>${transferData.amount.toFixed(2)} ${transferData.currency === 'DZD' ? 'Ø¯Ø¬' : '$'}</strong> Ø¨Ù†Ø¬Ø§Ø­ Ø¥Ù„Ù‰ <strong>${transferData.recipient.name}</strong>.<br>
            Ø³ØªØ¸Ù‡Ø± Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© ÙÙŠ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø®Ù„Ø§Ù„ Ø¨Ø¶Ø¹ Ø¯Ù‚Ø§Ø¦Ù‚.
          `;
          
          document.getElementById('transferSuccessScreen').style.display = 'block';
          transferData.transactionId = generateTransactionId();
        }
      } catch (error) {
        showTransferError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­ÙˆÙŠÙ„');
      }
    }

    function showTransferError(message) {
      const errorAlert = document.getElementById('transferErrorAlert');
      errorAlert.textContent = message;
      errorAlert.style.display = 'block';
      document.getElementById('transferSuccessAlert').style.display = 'none';
    }

    function showTransferSuccess(message) {
      const successAlert = document.getElementById('transferSuccessAlert');
      successAlert.textContent = message;
      successAlert.style.display = 'block';
      document.getElementById('transferErrorAlert').style.display = 'none';
    }

    function hideTransferAlerts() {
      document.getElementById('transferErrorAlert').style.display = 'none';
      document.getElementById('transferSuccessAlert').style.display = 'none';
    }

    function generateTransactionId() {
      const prefix = 'TRX-';
      const randomNum = Math.floor(Math.random() * 1000000).toString().padStart(6, '0');
      return prefix + randomNum;
    }

    // ========== Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø­ÙØ¸Ø© ==========
    function updateUserInterface(userData) {
      try {
        const userName = userData.firstName || userData.first_name || 'Ù…Ø³ØªØ®Ø¯Ù…';
        const userLastName = userData.lastName || userData.last_name || '';
        const fullName = userName + (userLastName ? ' ' + userLastName : '');
        
        document.getElementById('walletUserName').textContent = fullName;
        document.getElementById('walletUserId').textContent = `id: ${userData.id}`;
        document.getElementById('walletCoinIcon').textContent = 'ğŸ’°';
        
        document.getElementById('bankUserId').textContent = userData.id;
        
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
      }
    }

    function updateWalletsListRealTime() {
      const walletsList = document.getElementById('walletWalletsList');
      walletsList.innerHTML = '';
      
      const dzdBalance = userBalances['DZD'] || 0;
      const dzdElement = document.createElement('div');
      dzdElement.className = 'wallet-coin-row';
      dzdElement.innerHTML = `
        <div style="display:flex;align-items:center;gap:12px">
          <div class="wallet-badge">Ø¯Ø¬</div>
          <div class="wallet-coin-meta">
            <div class="n">Ø§Ù„Ø¯ÙŠÙ†Ø§Ø± Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠ</div>
            <div class="s">DZD - Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„ÙˆØ·Ù†ÙŠØ©</div>
            <div class="rate">1 Ø¯Ø¬ = ${exchangeRates.DZD_USD.toFixed(4)} $</div>
          </div>
        </div>
        <div class="wallet-coin-val">
          <div class="qty">${dzdBalance.toFixed(2)} DZD</div>
          <div class="fiat">${(dzdBalance * exchangeRates.DZD_USD).toFixed(2)} $</div>
          <div class="change positive">â†» Ù…Ø­ÙØ¸Ø© Ù†Ø´Ø·Ø©</div>
        </div>
      `;
      walletsList.appendChild(dzdElement);
      
      const usdBalance = userBalances['USD'] || 0;
      const usdElement = document.createElement('div');
      usdElement.className = 'wallet-coin-row';
      usdElement.innerHTML = `
        <div style="display:flex;align-items:center;gap:12px">
          <div class="wallet-badge usd">$</div>
          <div class="wallet-coin-meta">
            <div class="n">Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠ</div>
            <div class="s">USD - Ø¹Ù…Ù„Ø© Ø¯ÙˆÙ„ÙŠØ©</div>
            <div class="rate">1 $ = ${exchangeRates.USD_DZD.toFixed(2)} Ø¯Ø¬</div>
          </div>
        </div>
        <div class="wallet-coin-val">
          <div class="qty">${usdBalance.toFixed(2)} USD</div>
          <div class="fiat">${(usdBalance * exchangeRates.USD_DZD).toFixed(2)} Ø¯Ø¬</div>
          <div class="change positive">â†» Ù…Ø­ÙØ¸Ø© Ù†Ø´Ø·Ø©</div>
        </div>
      `;
      walletsList.appendChild(usdElement);
    }

    function updateTotalBalance() {
      let totalBalanceDZD = 0;
      totalBalanceDZD += userBalances['DZD'] || 0;
      totalBalanceDZD += (userBalances['USD'] || 0) * exchangeRates.USD_DZD;
      document.getElementById('walletTotalBalance').textContent = `${totalBalanceDZD.toFixed(2)} Ø¯Ø¬`;
    }

    // ========== Ø¯ÙˆØ§Ù„ Ø´Ø¨ÙƒØ© Ø§Ù„ØªØ¨Ø§Ø¯Ù„ ==========
    function openExchangeModal() {
      document.getElementById('exchangeModal').classList.add('open');
    }

    function closeExchangeModal() {
      document.getElementById('exchangeModal').classList.remove('open');
    }

    function openCreateExchangeModal() {
      updateAvailableBalances();
      document.getElementById('createExchangeModal').classList.add('open');
      
      document.getElementById('sellAmount').value = '';
      document.getElementById('exchangeRate').value = '';
      
      updateExchangeSummary();
    }

    function closeCreateExchangeModal() {
      document.getElementById('createExchangeModal').classList.remove('open');
    }

    function renderExchangeCards() {
      const container = document.getElementById('exchangeContainer');
      container.innerHTML = '';

      if (activeExchangeOrders.length === 0) {
        container.innerHTML = `
          <div style="text-align:center;padding:40px 20px;color:var(--text-light);">
            <i class="fas fa-exchange-alt" style="font-size:48px;margin-bottom:15px;opacity:0.5;"></i>
            <div style="font-size:16px;margin-bottom:10px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª ØªØ¨Ø§Ø¯Ù„ Ø­Ø§Ù„ÙŠØ§Ù‹</div>
            <div style="font-size:14px;">ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠÙ†Ø´Ø¦ Ø·Ù„Ø¨ ØªØ¨Ø§Ø¯Ù„!</div>
          </div>
        `;
        return;
      }

      activeExchangeOrders.forEach(order => {
        if (order.userId === currentUser.id.toString()) return;
        
        const card = document.createElement('div');
        card.className = 'exchange-card';
        card.setAttribute('data-type', order.type);
        
        const badgeClass = order.type === 'sell-usd' ? 'sell-usd' : 'sell-dzd';
        const badgeIcon = order.type === 'sell-usd' ? 'fa-dollar-sign' : 'fa-dinar-sign';
        const currencyIcon = order.type === 'sell-usd' ? 'fa-dollar-sign' : 'fa-dinar-sign';
        
        const totalAmount = order.type === 'sell-usd' 
          ? (order.sellAmount * order.exchangeRate).toFixed(0)
          : (order.sellAmount / order.exchangeRate).toFixed(2);
          
        const totalDisplay = order.type === 'sell-usd'
          ? `${totalAmount} Ø¯Ø¬`
          : `${totalAmount} $`;
        
        const orderTime = order.createdAt;
        const timeString = orderTime ? orderTime.toLocaleTimeString('ar-EG', {
          hour: '2-digit',
          minute: '2-digit'
        }) : 'Ø§Ù„Ø¢Ù†';
        
        card.innerHTML = `
          <div class="exchange-card-header">
            <div class="exchange-badge ${badgeClass}">
              <i class="fas ${badgeIcon}"></i>
              ${order.type === 'sell-usd' ? 'Ø¨ÙŠØ¹ Ø¯ÙˆÙ„Ø§Ø±' : 'Ø¨ÙŠØ¹ Ø¯ÙŠÙ†Ø§Ø±'}
            </div>
            <div class="exchange-user-info">
              <div class="exchange-avatar">${order.userName?.charAt(0) || 'Ù…'}</div>
              <div class="exchange-user-name">${order.userName || 'Ù…Ø³ØªØ®Ø¯Ù…'}</div>
            </div>
          </div>
          
          <div class="exchange-card-body">
            <div class="exchange-currency-info">
              <div class="exchange-currency-details">
                <div class="exchange-currency-name">
                  <i class="fas ${currencyIcon}"></i>
                  ${order.type === 'sell-usd' ? 'Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ' : 'Ø¯ÙŠÙ†Ø§Ø± Ø¬Ø²Ø§Ø¦Ø±ÙŠ'}
                </div>
                <div class="exchange-currency-amount">Ø§Ù„ÙƒÙ…ÙŠØ©: ${order.sellAmount.toLocaleString()} ${order.sellCurrency}</div>
              </div>
              <div class="exchange-rate">
                <span class="exchange-rate-label">Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù</span>
                <span class="exchange-rate-value">1${order.type === 'sell-usd' ? '$' : 'Ø¯Ø¬'} = ${order.exchangeRate}${order.type === 'sell-usd' ? 'Ø¯Ø¬' : '$'}</span>
              </div>
            </div>
            
            <div class="exchange-info">
              <span>ÙŠØ³ØªÙ‚Ø¨Ù„:</span>
              <i class="fas fa-arrow-left"></i>
              <span>${order.type === 'sell-usd' ? 'Ø¯ÙŠÙ†Ø§Ø± Ø¬Ø²Ø§Ø¦Ø±ÙŠ' : 'Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ'}</span>
            </div>
            
            <div class="exchange-details">
              <div class="exchange-detail-item">
                <span class="exchange-detail-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</span>
                <span class="exchange-detail-value">${timeString}</span>
              </div>
              <div class="exchange-detail-item">
                <span class="exchange-detail-label">Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</span>
                <span class="exchange-detail-value" style="color: var(--success);">Ù†Ø´Ø·</span>
              </div>
            </div>
            
            <div class="exchange-total-container">
              <span class="exchange-total-label">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
              <span class="exchange-total-value">${totalDisplay}</span>
            </div>
            
            <button class="exchange-action-btn" data-id="${order.id}">
              <i class="fas fa-exchange-alt"></i>
              Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ù…Ø¹Ù‡
            </button>
          </div>
        `;
        
        container.appendChild(card);
      });

      // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ù„Ù„ÙÙ„Ø§ØªØ±
      document.querySelectorAll('.exchange-filter-btn').forEach(button => {
        button.addEventListener('click', function() {
          document.querySelectorAll('.exchange-filter-btn').forEach(btn => btn.classList.remove('active'));
          this.classList.add('active');
          
          const filter = this.getAttribute('data-filter');
          const cards = document.querySelectorAll('.exchange-card');
          
          cards.forEach(card => {
            const cardType = card.getAttribute('data-type');
            
            if (filter === 'all') {
              card.style.display = 'flex';
            } else {
              card.style.display = cardType === filter ? 'flex' : 'none';
            }
          });
        });
      });

      // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¨Ø§Ø¯Ù„
      document.querySelectorAll('.exchange-action-btn').forEach(button => {
        button.addEventListener('click', function() {
          const orderId = this.getAttribute('data-id');
          const order = activeExchangeOrders.find(o => o.id == orderId);
          
          if (order) {
            currentExchangeOrderId = orderId;
            const actionType = order.type === 'sell-usd' ? 'Ø´Ø±Ø§Ø¡ Ø¯ÙˆÙ„Ø§Ø±' : 'Ø´Ø±Ø§Ø¡ Ø¯ÙŠÙ†Ø§Ø±';
            const totalAmount = order.type === 'sell-usd' 
              ? (order.sellAmount * order.exchangeRate).toFixed(0)
              : (order.sellAmount / order.exchangeRate).toFixed(2);
            
            document.getElementById('exchangeDialogMessage').innerHTML = `
              Ø£Ù†Øª Ø¹Ù„Ù‰ ÙˆØ´Ùƒ ${actionType} Ù…Ù† <strong>${order.userName}</strong>.<br><br>
              <strong>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©:</strong><br>
              - Ø§Ù„ÙƒÙ…ÙŠØ©: ${order.sellAmount} ${order.sellCurrency}<br>
              - Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù: 1${order.type === 'sell-usd' ? '$' : 'Ø¯Ø¬'} = ${order.exchangeRate}${order.type === 'sell-usd' ? 'Ø¯Ø¬' : '$'}<br>
              - Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${totalAmount} ${order.type === 'sell-usd' ? 'Ø¯Ø¬' : '$'}<br><br>
              <strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> Ø³ÙŠØªÙ… Ø®ØµÙ… Ø§Ù„Ù…Ø¨Ù„Øº Ù…Ù† Ø±ØµÙŠØ¯Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„ØªØ£ÙƒÙŠØ¯.
            `;
            
            updateTransactionDetails();
            document.getElementById('exchangeDialog').style.display = 'flex';
          }
        });
      });
    }

    function updateTransactionDetails() {
      const now = new Date();
      const formattedDate = now.toLocaleDateString('ar-EG', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });
      const formattedTime = now.toLocaleTimeString('ar-EG', {
        hour: '2-digit',
        minute: '2-digit'
      });
      
      document.getElementById('exchangeTransactionDate').textContent = `${formattedDate} ${formattedTime}`;
      document.getElementById('exchangeTransactionId').textContent = 'TRX-' + String(Math.floor(Math.random() * 1000)).padStart(3, '0');
    }

    async function processExchange() {
      if (!currentExchangeOrderId) {
        showToast('âŒ Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø·Ù„Ø¨ ØªØ¨Ø§Ø¯Ù„', 'error');
        return;
      }
      
      const success = await executeExchange(currentExchangeOrderId, currentUser.id);
      
      if (success) {
        document.getElementById('exchangeDialog').style.display = 'none';
        currentExchangeOrderId = null;
      }
    }

    function updateAvailableBalances() {
      if (userBalances) {
        document.getElementById('availableDZD').textContent = `${userBalances['DZD'].toFixed(2)} Ø¯Ø¬`;
        document.getElementById('availableUSD').textContent = `${userBalances['USD'].toFixed(2)} $`;
      }
    }

    function updateExchangeSummary() {
      const type = document.getElementById('exchangeType').value;
      const amount = parseFloat(document.getElementById('sellAmount').value) || 0;
      const rate = parseFloat(document.getElementById('exchangeRate').value) || 0;
      
      if (amount && rate) {
        document.getElementById('summaryAmount').textContent = `${amount} ${type === 'sell-usd' ? '$' : 'Ø¯Ø¬'}`;
        document.getElementById('summaryRate').textContent = `${rate} ${type === 'sell-usd' ? 'Ø¯Ø¬' : '$'}`;
        document.getElementById('summaryTotal').textContent = type === 'sell-usd' 
          ? `${(amount * rate).toFixed(0)} Ø¯Ø¬` 
          : `${(amount / rate).toFixed(2)} $`;
      }
    }

    async function createExchangeOrder() {
      const type = document.getElementById('exchangeType').value;
      const amount = parseFloat(document.getElementById('sellAmount').value);
      const rate = parseFloat(document.getElementById('exchangeRate').value);
      
      if (!amount || amount <= 0) {
        showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­', 'error');
        return;
      }
      
      if (!rate || rate <= 0) {
        showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¹Ø± ØµØ±Ù ØµØ­ÙŠØ­', 'error');
        return;
      }
      
      const orderId = await createExchangeOrder(currentUser.id, type, amount, rate);
      
      if (orderId) {
        closeCreateExchangeModal();
      }
    }

    // ========== Ø¯ÙˆØ§Ù„ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø£Ù…ÙˆØ§Ù„ ==========
    function openReceiveModal() {
      document.getElementById('walletReceiveModal').classList.add('open');
    }

    function closeReceiveModal() {
      document.getElementById('walletReceiveModal').classList.remove('open');
    }

    function showBankNotification(message, isError = false) {
      const notification = document.getElementById('bankNotification');
      const notificationText = document.getElementById('bankNotificationText');
      
      notificationText.textContent = message;
      
      if (isError) {
        notification.style.background = 'linear-gradient(to right, #ff6b6b, #ff5252)';
      } else {
        notification.style.background = 'linear-gradient(to right, var(--primary), var(--secondary))';
      }
      
      notification.classList.add('show');
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    function processBankTransfer() {
      const transferType = document.getElementById('bankTransferType').value;
      const transactionNumber = document.getElementById('bankTransactionNumber').value.trim();
      const amount = document.getElementById('bankAmount').value.trim();
      const currency = transferType === 'bank' ? 'DZD' : 'USD';
      const transferTypeName = transferType === 'bank' ? 'Ø¨Ù†ÙƒÙŠ' : 'Ø¨ÙŠÙ†Ø§Ù†Ø³';
      
      if (!transactionNumber) {
        showBankNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©', true);
        document.getElementById('bankTransactionNumber').focus();
        return;
      }
      
      if (!amount) {
        showBankNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø­ÙˆÙ„', true);
        document.getElementById('bankAmount').focus();
        return;
      }
      
      if (isNaN(parseFloat(amount)) || !isFinite(amount)) {
        showBankNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­ (Ø±Ù‚Ù…)', true);
        document.getElementById('bankAmount').focus();
        return;
      }
      
      showBankNotification(`ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„ ${transferTypeName} Ø¨Ù†Ø¬Ø§Ø­: Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© ${transactionNumber} ÙˆØ§Ù„Ù…Ø¨Ù„Øº ${amount} ${currency}`);
      
      const successAnimation = document.getElementById('bankSuccessAnimation');
      successAnimation.style.display = 'block';
      
      setTimeout(() => {
        document.getElementById('bankTransactionNumber').value = '';
        document.getElementById('bankAmount').value = '';
      }, 500);
      
      setTimeout(() => {
        successAnimation.style.display = 'none';
      }, 3000);
      
      const submitBtn = document.getElementById('bankSubmitBtn');
      const originalHTML = submitBtn.innerHTML;
      submitBtn.innerHTML = '<i class="fas fa-check"></i> ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­';
      submitBtn.style.background = 'linear-gradient(to right, var(--success), #26c97c)';
      
      setTimeout(() => {
        submitBtn.innerHTML = originalHTML;
        submitBtn.style.background = 'linear-gradient(to right, var(--success), #26c97c)';
      }, 3000);
    }

    function initializeBankCopyButtons() {
      const accountValue = '079999900238685859563';
      const binanceValue = '1143951718';
      
      document.getElementById('bankCopyIdBtn').addEventListener('click', function() {
        const userId = currentUser ? currentUser.id.toString() : '';
        if (!userId) {
          showBankNotification('Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø¹Ø¯', true);
          return;
        }
        
        navigator.clipboard.writeText(userId)
          .then(() => {
            showBankNotification('ØªÙ… Ù†Ø³Ø® Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙ Ø¨Ù†Ø¬Ø§Ø­');
            
            const originalHTML = this.innerHTML;
            this.innerHTML = '<i class="fas fa-check"></i> ØªÙ… Ø§Ù„Ù†Ø³Ø®';
            this.style.background = 'linear-gradient(to right, var(--success), #26c97c)';
            
            setTimeout(() => {
              this.innerHTML = originalHTML;
              this.style.background = 'linear-gradient(to right, var(--primary), var(--secondary))';
            }, 2000);
          })
          .catch(err => {
            console.error('ÙØ´Ù„ ÙÙŠ Ù†Ø³Ø® Ø§Ù„Ù†Øµ: ', err);
            showBankNotification('ÙØ´Ù„ ÙÙŠ Ù†Ø³Ø® Ø§Ù„Ù†ØµØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰', true);
          });
      });
      
      document.getElementById('bankCopyAccountBtn').addEventListener('click', function() {
        navigator.clipboard.writeText(accountValue)
          .then(() => {
            showBankNotification('ØªÙ… Ù†Ø³Ø® Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨ BaridiMob Ø¨Ù†Ø¬Ø§Ø­');
            
            const originalHTML = this.innerHTML;
            this.innerHTML = '<i class="fas fa-check"></i> ØªÙ… Ø§Ù„Ù†Ø³Ø®';
            this.style.background = 'linear-gradient(to right, #e53935, #ef5350)';
            
            setTimeout(() => {
              this.innerHTML = originalHTML;
              this.style.background = 'linear-gradient(to right, var(--primary), var(--secondary))';
            }, 2000);
          })
          .catch(err => {
            console.error('ÙØ´Ù„ ÙÙŠ Ù†Ø³Ø® Ø§Ù„Ù†Øµ: ', err);
            showBankNotification('ÙØ´Ù„ ÙÙŠ Ù†Ø³Ø® Ø§Ù„Ù†ØµØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰', true);
          });
      });
      
      document.getElementById('bankCopyBinanceBtn').addEventListener('click', function() {
        navigator.clipboard.writeText(binanceValue)
          .then(() => {
            showBankNotification('ØªÙ… Ù†Ø³Ø® Ø±Ù‚Ù… ØªØ¹Ø±ÙŠÙ Ø¨ÙŠÙ†Ø§Ù†Ø³ Ø¨Ù†Ø¬Ø§Ø­');
            
            const originalHTML = this.innerHTML;
            this.innerHTML = '<i class="fas fa-check"></i> ØªÙ… Ø§Ù„Ù†Ø³Ø®';
            this.style.background = 'linear-gradient(to right, #F0B90B, #F0D90B)';
            this.style.color = '#1E2026';
            
            setTimeout(() => {
              this.innerHTML = originalHTML;
              this.style.background = 'linear-gradient(to right, var(--primary), var(--secondary))';
              this.style.color = 'white';
            }, 2000);
          })
          .catch(err => {
            console.error('ÙØ´Ù„ ÙÙŠ Ù†Ø³Ø® Ø§Ù„Ù†Øµ: ', err);
            showBankNotification('ÙØ´Ù„ ÙÙŠ Ù†Ø³Ø® Ø§Ù„Ù†ØµØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰', true);
          });
      });
    }

    // ========== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ==========
    document.addEventListener('DOMContentLoaded', async function() {
      console.log('ğŸš€ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©...');
      
      let mockUser = null;
      
      if (window.Telegram && Telegram.WebApp) {
        const tg = Telegram.WebApp;
        tg.ready();
        tg.expand();
        
        const tgUser = tg.initDataUnsafe?.user;
        if (tgUser) {
          mockUser = {
            id: tgUser.id,
            first_name: tgUser.first_name,
            last_name: tgUser.last_name || '',
            username: tgUser.username
          };
          
          await saveUserToFirebase(mockUser);
        }
      }
      
      if (!mockUser) {
        mockUser = {
          id: 5922049376,
          first_name: 'Akram',
          last_name: 'Khezzari', 
          username: 'A_mja_d_0_5'
        };
        
        await saveUserToFirebase(mockUser);
      }
      
      currentUser = mockUser;
      
      const userData = await getUserFromFirebase(currentUser.id);
      if (userData) {
        updateUserInterface(userData);
        
        if (userData.balances) {
          userBalances.DZD = userData.balances.DZD || 0;
          userBalances.USD = userData.balances.USD || 0;
        }
        
        setupRealtimeUserListener(currentUser.id);
        setupRealtimeExchangeListener();
        
        updateWalletsListRealTime();
        updateTotalBalance();
        updateTransferBalanceDisplay();
        updateAvailableBalances();
      }
      
      // Ø£Ø­Ø¯Ø§Ø« Ù†Ø¸Ø§Ù… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯
      document.getElementById('walletSendBtn').addEventListener('click', openMoneyTransferModal);
      document.getElementById('transferCloseBtn').addEventListener('click', function() {
        if (transferData.currentStep > 1) {
          if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ØŸ Ø³ÙŠØªÙ… ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©.')) {
            closeMoneyTransferModal();
          }
        } else {
          closeMoneyTransferModal();
        }
      });
      document.getElementById('transferNextBtn').addEventListener('click', goToNextTransferStep);
      document.getElementById('transferPrevBtn').addEventListener('click', goToPreviousTransferStep);
      document.getElementById('newTransferBtn').addEventListener('click', resetTransferForm);
      
      document.querySelectorAll('.currency-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('.currency-btn').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          transferData.currency = this.dataset.currency;
          updateTransferBalanceDisplay();
        });
      });
      
      document.querySelectorAll('.amount-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const amount = this.dataset.amount;
          document.getElementById('transferAmount').value = amount;
          transferData.amount = parseFloat(amount);
          validateTransferStep2();
        });
      });
      
      document.getElementById('transferAmount').addEventListener('input', function() {
        transferData.amount = parseFloat(this.value) || 0;
        validateTransferStep2();
      });
      
      document.getElementById('transferRecipientId').addEventListener('input', async function() {
        await validateTransferStep1();
      });
      
      // Ø£Ø­Ø¯Ø§Ø« Ø´Ø¨ÙƒØ© Ø§Ù„ØªØ¨Ø§Ø¯Ù„
      document.getElementById('walletNetworkBtn').addEventListener('click', openExchangeModal);
      document.getElementById('exchangeCloseBtn').addEventListener('click', closeExchangeModal);
      document.getElementById('exchangeCreateBtn').addEventListener('click', openCreateExchangeModal);
      document.getElementById('createExchangeCloseBtn').addEventListener('click', closeCreateExchangeModal);
      document.getElementById('createExchangeCancel').addEventListener('click', closeCreateExchangeModal);
      document.getElementById('createExchangeSubmit').addEventListener('click', createExchangeOrder);
      
      // Ø£Ø­Ø¯Ø§Ø« Ù†Ø§ÙØ°Ø© Ø­ÙˆØ§Ø± Ø§Ù„ØªØ¨Ø§Ø¯Ù„
      document.getElementById('exchangeDialogClose').addEventListener('click', function() {
        document.getElementById('exchangeDialog').style.display = 'none';
        currentExchangeOrderId = null;
      });
      document.getElementById('exchangeDialogCancel').addEventListener('click', function() {
        document.getElementById('exchangeDialog').style.display = 'none';
        currentExchangeOrderId = null;
      });
      document.getElementById('exchangeDialogConfirm').addEventListener('click', processExchange);
      
      // Ø£Ø­Ø¯Ø§Ø« ØªØ­Ø¯ÙŠØ« Ù…Ù„Ø®Øµ Ø§Ù„ØªØ¨Ø§Ø¯Ù„
      document.getElementById('exchangeType').addEventListener('change', updateExchangeSummary);
      document.getElementById('sellAmount').addEventListener('input', updateExchangeSummary);
      document.getElementById('exchangeRate').addEventListener('input', updateExchangeSummary);
      
      // Ø£Ø­Ø¯Ø§Ø« Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø£Ù…ÙˆØ§Ù„
      document.getElementById('walletReceiveBtn').addEventListener('click', openReceiveModal);
      document.getElementById('receiveCloseBtn').addEventListener('click', closeReceiveModal);
      document.getElementById('bankSubmitBtn').addEventListener('click', processBankTransfer);
      initializeBankCopyButtons();
      
      // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø¨Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
      document.getElementById('moneyTransferModal').addEventListener('click', function(e) {
        if (e.target === this) {
          if (transferData.currentStep > 1) {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ØŸ Ø³ÙŠØªÙ… ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©.')) {
              closeMoneyTransferModal();
            }
          } else {
            closeMoneyTransferModal();
          }
        }
      });
      
      document.getElementById('exchangeModal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeExchangeModal();
        }
      });
      
      document.getElementById('createExchangeModal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeCreateExchangeModal();
        }
      });
      
      document.getElementById('exchangeDialog').addEventListener('click', function(e) {
        if (e.target === this) {
          document.getElementById('exchangeDialog').style.display = 'none';
          currentExchangeOrderId = null;
        }
      });
      
      document.getElementById('walletReceiveModal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeReceiveModal();
        }
      });
    });
  </script>
</body>
</html>
