<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</title>
  
  <!-- Telegram Web App SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  
  <!-- Ù…ÙƒØªØ¨Ø© axios -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    /* Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ© Ø§Ù„Ø£ØµÙ„ÙŠØ© */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    :root {
      --primary: #006633;
      --secondary: #00cc66;
      --dollar-blue: #0057b7;
      --dollar-light: #2d87ff;
      --danger: #ff4757;
      --success: #26a17b;
      --warning: #ff9f00;
      --info: #2d87ff;
      --bg-light: #ffffff;
      --bg-lighter: #f8f9fa;
      --text-dark: #1a1a1a;
      --text-gray: #666;
      --text-light: #888;
      --border-light: rgba(0, 0, 0, 0.1);
      --shadow-light: rgba(0, 0, 0, 0.08);
    }

    body {
      background: #ffffff;
      color: var(--text-dark);
      min-height: 100vh;
      padding: 0;
    }

    .wallet-page {
      padding: 15px;
      background: #ffffff;
      min-height: 100vh;
    }

    .wallet-frame {
      width: 100%;
      max-width: 420px;
      margin: 0 auto;
      background: #ffffff;
      overflow: hidden;
      position: relative;
    }

    .wallet-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 12px 0;
      border-bottom: 1px solid var(--border-light);
      margin-bottom: 15px;
    }

    .wallet-brand {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .wallet-avatar {
      width: 52px;
      height: 52px;
      border-radius: 999px;
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      box-shadow: 0 2px 8px var(--shadow-light);
      border: 1px solid rgba(255, 255, 255, 0.8);
    }

    .wallet-coin-icon {
      width: 38px;
      height: 38px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 16px;
      color: #ffffff;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      box-shadow: 0 4px 12px rgba(0,102,51,0.2);
      transform-origin: center;
    }

    .wallet-user-meta {
      text-align: right;
    }

    .wallet-user-meta .name {
      font-weight: 700;
      font-size: 14px;
      color: var(--text-dark);
    }

    .wallet-user-meta .sub {
      font-size: 11px;
      color: var(--text-light);
      cursor: pointer;
      transition: all 0.3s ease;
      padding: 2px 6px;
      border-radius: 6px;
    }

    .wallet-user-meta .sub:hover {
      background: rgba(0, 102, 51, 0.1);
      color: var(--primary);
    }

    .wallet-controls {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .wallet-channel-btn {
      padding: 8px 12px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      border: none;
      cursor: pointer;
      color: #ffffff;
      transition: all 0.3s ease;
      font-size: 12px;
      font-weight: 600;
      text-decoration: none;
      box-shadow: 0 2px 8px rgba(0,102,51,0.2);
    }

    .wallet-content {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .wallet-balance-card {
      background: linear-gradient(135deg, #f8f9fa, #ffffff);
      border-radius: 16px;
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border: 1px solid rgba(0, 102, 51, 0.1);
      box-shadow: 0 4px 16px var(--shadow-light);
    }

    .wallet-balance-left {
      text-align: right;
    }

    .wallet-bal-label {
      color: var(--text-light);
      font-size: 12px;
    }

    .wallet-bal-amount {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-dark);
      margin-top: 6px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .wallet-bal-trend {
      font-size: 12px;
      color: var(--success);
      background: rgba(38, 161, 123, 0.1);
      padding: 6px 8px;
      border-radius: 10px;
      font-weight: 700;
      border: 1px solid rgba(38, 161, 123, 0.2);
    }

    .wallet-bal-trend.negative {
      color: var(--danger);
      background: rgba(255, 71, 87, 0.1);
      border-color: rgba(255, 71, 87, 0.2);
    }

    .wallet-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .wallet-neon-btn {
      flex: 1;
      padding: 12px;
      border-radius: 12px;
      border: none;
      font-weight: 700;
      cursor: pointer;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      color: #ffffff;
      box-shadow: 0 4px 16px rgba(0,102,51,0.2);
      font-size: 14px;
      transition: all 0.3s ease;
      min-width: 120px;
    }

    .wallet-send-btn {
      flex: 1;
      padding: 12px;
      border-radius: 12px;
      border: none;
      font-weight: 700;
      cursor: pointer;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      color: #ffffff;
      box-shadow: 0 4px 16px rgba(0,102,51,0.2);
      font-size: 14px;
      transition: all 0.3s ease;
      min-width: 120px;
    }

    .wallet-exchange-btn {
      flex: 1;
      padding: 12px;
      border-radius: 12px;
      border: none;
      font-weight: 700;
      cursor: pointer;
      background: linear-gradient(90deg, #8e44ad, #9b59b6);
      color: #ffffff;
      box-shadow: 0 4px 16px rgba(142, 68, 173, 0.2);
      font-size: 14px;
      transition: all 0.3s ease;
      min-width: 120px;
    }

    .wallet-ghost-btn {
      flex: 1;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid var(--border-light);
      background: #f8f9fa;
      color: var(--text-gray);
      font-weight: 700;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .wallet-section-title {
      font-size: 13px;
      color: var(--text-gray);
      margin-bottom: 8px;
      font-weight: 600;
    }

    .wallet-wallets {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .wallet-coin-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px;
      border-radius: 12px;
      background: #f8f9fa;
      border: 1px solid transparent;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .wallet-badge {
      width: 42px;
      height: 42px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 14px;
      color: #ffffff;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      box-shadow: 0 4px 12px rgba(0,102,51,0.2);
    }

    .wallet-badge.usd {
      background: linear-gradient(90deg, var(--dollar-blue), var(--dollar-light));
      box-shadow: 0 4px 12px rgba(0, 87, 183, 0.2);
    }

    .wallet-coin-meta {
      text-align: right;
    }

    .wallet-coin-meta .n {
      font-weight: 700;
      font-size: 14px;
      color: var(--text-dark);
    }

    .wallet-coin-meta .s {
      font-size: 11px;
      color: var(--text-light);
      margin-top: 4px;
    }

    .wallet-coin-meta .rate {
      font-size: 10px;
      color: var(--text-gray);
      margin-top: 2px;
    }

    .wallet-coin-val {
      text-align: left;
    }

    .wallet-coin-val .qty {
      font-weight: 700;
      font-size: 14px;
      color: var(--text-dark);
    }

    .wallet-coin-val .fiat {
      font-size: 11px;
      color: var(--text-light);
      margin-top: 4px;
    }

    .wallet-coin-val .change {
      font-size: 10px;
      margin-top: 2px;
      font-weight: 600;
    }

    .change.positive {
      color: var(--success);
    }

    .change.negative {
      color: var(--danger);
    }

    .wallet-smallnote {
      text-align: center;
      color: var(--text-light);
      font-size: 11px;
      padding: 20px 0 10px;
      opacity: 0.7;
    }

    .wallet-loading-spinner {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255,255,255,0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }

    .wallet-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(0,102,51,0.3);
      border-radius: 50%;
      border-top-color: var(--primary);
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .wallet-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255,255,255,0.9);
      backdrop-filter: blur(5px);
      z-index: 80;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 12px;
    }

    .wallet-modal.open {
      display: flex;
    }

    .wallet-modal-card {
      width: 100%;
      max-width: 360px;
      border-radius: 16px;
      padding: 20px;
      background: #ffffff;
      border: 1px solid var(--border-light);
      box-shadow: 0 10px 40px var(--shadow-light);
      max-height: 90vh;
      overflow-y: auto;
    }

    .transfer-form {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .form-label {
      font-size: 14px;
      color: var(--text-dark);
      font-weight: 600;
    }

    .form-input {
      padding: 12px;
      border-radius: 10px;
      border: 1px solid var(--border-light);
      background: #ffffff;
      font-size: 14px;
      width: 100%;
    }

    .form-select {
      padding: 12px;
      border-radius: 10px;
      border: 1px solid var(--border-light);
      background: #ffffff;
      font-size: 14px;
      width: 100%;
    }

    .user-search-result {
      background: var(--bg-lighter);
      padding: 10px;
      border-radius: 8px;
      margin: 5px 0;
      border: 1px solid var(--border-light);
    }

    .user-search-result.found {
      border-color: var(--success);
      background: rgba(38, 161, 123, 0.05);
    }

    .user-search-result.not-found {
      border-color: var(--danger);
      background: rgba(255, 71, 87, 0.05);
    }

    .currency-switcher {
      display: flex;
      gap: 8px;
      margin: 10px 0;
      background: var(--bg-lighter);
      padding: 8px;
      border-radius: 10px;
    }

    .currency-tab {
      flex: 1;
      padding: 8px;
      text-align: center;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      font-size: 13px;
    }

    .currency-tab.active {
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      color: white;
      box-shadow: 0 2px 8px rgba(0,102,51,0.2);
    }

    .currency-tab.usd.active {
      background: linear-gradient(90deg, var(--dollar-blue), var(--dollar-light));
      box-shadow: 0 2px 8px rgba(0, 87, 183, 0.2);
    }

    /* Ø£Ù†Ù…Ø§Ø· Ù†Ø§ÙØ°Ø© Ø´Ø¨ÙƒØ© Ø§Ù„ØªØ¨Ø§Ø¯Ù„ */
    .exchange-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255,255,255,0.95);
      z-index: 200;
      display: none;
      overflow-y: auto;
    }

    .exchange-modal.open {
      display: block;
    }

    .exchange-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px 15px;
      text-align: center;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .exchange-close-btn {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .exchange-title {
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 5px;
    }

    .exchange-subtitle {
      font-size: 0.9rem;
      opacity: 0.9;
    }

    .exchange-filters {
      padding: 15px;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 8px;
      background: white;
      border-bottom: 1px solid var(--border-light);
    }

    .exchange-filter-btn {
      padding: 8px 16px;
      border-radius: 20px;
      background: white;
      border: 1px solid var(--border-light);
      color: var(--text-dark);
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .exchange-filter-btn:hover {
      background: var(--bg-lighter);
      border-color: var(--primary);
    }

    .exchange-filter-btn.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .exchange-container {
      padding: 15px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 15px;
      background: #f8f9fa;
      min-height: calc(100vh - 180px);
    }

    @media (max-width: 768px) {
      .exchange-container {
        grid-template-columns: 1fr;
      }
    }

    .exchange-card {
      background: white;
      border: 1px solid var(--border-light);
      border-radius: 12px;
      padding: 15px;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      box-shadow: 0 3px 10px rgba(0,0,0,0.05);
    }

    .exchange-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 15px rgba(0,0,0,0.1);
      border-color: var(--primary);
    }

    .exchange-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .exchange-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .exchange-badge.sell-usd {
      background: rgba(239, 68, 68, 0.1);
      color: var(--danger);
      border: 1px solid rgba(239, 68, 68, 0.2);
    }

    .exchange-badge.sell-dzd {
      background: rgba(34, 197, 94, 0.1);
      color: var(--success);
      border: 1px solid rgba(34, 197, 94, 0.2);
    }

    .exchange-user-info {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .exchange-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      font-weight: bold;
      color: white;
    }

    .exchange-user-name {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-dark);
    }

    .exchange-card-body {
      flex-grow: 1;
    }

    .exchange-currency-info {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .exchange-currency-details {
      flex-grow: 1;
    }

    .exchange-currency-name {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-dark);
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .exchange-currency-amount {
      font-size: 0.9rem;
      color: var(--text-light);
    }

    .exchange-rate {
      text-align: left;
    }

    .exchange-rate-label {
      display: block;
      font-size: 0.8rem;
      color: var(--text-light);
      margin-bottom: 4px;
    }

    .exchange-rate-value {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text-dark);
    }

    .exchange-info {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin: 12px 0;
      font-size: 0.9rem;
      color: var(--text-gray);
    }

    .exchange-details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin: 12px 0;
      font-size: 0.85rem;
    }

    .exchange-detail-item {
      display: flex;
      flex-direction: column;
    }

    .exchange-detail-label {
      color: var(--text-light);
      font-size: 0.75rem;
      margin-bottom: 4px;
    }

    .exchange-detail-value {
      color: var(--text-dark);
      font-weight: 500;
      font-size: 0.85rem;
    }

    .exchange-total-container {
      background: var(--bg-lighter);
      border-radius: 8px;
      padding: 12px;
      margin: 12px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 1px solid var(--border-light);
    }

    .exchange-total-label {
      font-size: 0.9rem;
      color: var(--text-dark);
      font-weight: 600;
    }

    .exchange-total-value {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text-dark);
    }

    .exchange-action-btn {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 10px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-top: 8px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .exchange-action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .exchange-action-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .exchange-footer {
      padding: 15px;
      border-top: 1px solid var(--border-light);
      color: var(--text-light);
      font-size: 0.85rem;
      text-align: center;
      background: white;
    }

    /* Ø²Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ */
    .exchange-create-btn {
      position: fixed;
      bottom: 25px;
      left: 25px;
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      transition: all 0.3s ease;
      z-index: 100;
      border: none;
    }

    .exchange-create-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    /* Ù†Ø§ÙØ°Ø© Ø­ÙˆØ§Ø± Ø§Ù„ØªØ¨Ø§Ø¯Ù„ */
    .exchange-dialog {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 300;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .exchange-dialog-content {
      background: white;
      border-radius: 16px;
      padding: 25px;
      width: 100%;
      max-width: 450px;
      border: 1px solid var(--border-light);
      box-shadow: 0 15px 40px rgba(0,0,0,0.15);
      animation: slideInUp 0.3s ease;
    }

    @keyframes slideInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .exchange-dialog-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .exchange-dialog-title {
      font-size: 1.3rem;
      color: var(--text-dark);
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .exchange-dialog-close {
      background: none;
      border: none;
      color: var(--text-light);
      font-size: 24px;
      cursor: pointer;
      line-height: 1;
      padding: 5px;
    }

    .exchange-dialog-message {
      background: var(--bg-lighter);
      padding: 15px;
      border-radius: 10px;
      margin: 15px 0;
      line-height: 1.6;
      font-size: 0.95rem;
      border: 1px solid var(--border-light);
    }

    .exchange-dialog-details {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin: 20px 0;
    }

    .exchange-dialog-item {
      display: flex;
      flex-direction: column;
    }

    .exchange-dialog-label {
      color: var(--text-light);
      font-size: 0.8rem;
      margin-bottom: 4px;
    }

    .exchange-dialog-value {
      color: var(--text-dark);
      font-weight: 500;
      font-size: 0.95rem;
    }

    .exchange-dialog-actions {
      display: flex;
      gap: 12px;
      margin-top: 25px;
    }

    .exchange-dialog-btn {
      flex: 1;
      padding: 12px;
      border-radius: 10px;
      border: none;
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .exchange-dialog-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .exchange-dialog-btn.confirm {
      background: linear-gradient(135deg, var(--success), #22c55e);
      color: white;
    }

    .exchange-dialog-btn.cancel {
      background: var(--bg-lighter);
      color: var(--text-dark);
      border: 1px solid var(--border-light);
    }

    /* Ù†Ø§ÙØ°Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ ØªØ¨Ø§Ø¯Ù„ */
    .create-exchange-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255,255,255,0.95);
      z-index: 400;
      overflow-y: auto;
    }

    .create-exchange-modal.open {
      display: block;
    }

    .create-exchange-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px 15px;
      text-align: center;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .create-exchange-close-btn {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .create-exchange-form {
      padding: 20px;
      max-width: 500px;
      margin: 0 auto;
    }

    .form-row {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }

    .form-row .form-group {
      flex: 1;
    }

    .balance-info {
      background: var(--bg-lighter);
      padding: 10px;
      border-radius: 10px;
      margin-bottom: 15px;
      border: 1px solid var(--border-light);
    }

    .balance-info span {
      font-weight: 600;
      color: var(--primary);
    }

    /* Ø£Ù†Ù…Ø§Ø· Toast */
    .wallet-toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(0, 102, 51, 0.9);
      color: white;
      padding: 12px 20px;
      border-radius: 10px;
      font-size: 14px;
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      max-width: 300px;
      direction: rtl;
    }
  </style>
</head>
<body>
  <!-- ØµÙØ­Ø© Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
  <div class="wallet-page">
    <div class="wallet-frame">
      <div class="wallet-header">
        <div class="wallet-brand">
          <div class="wallet-avatar">
            <div class="wallet-coin-icon" id="walletCoinIcon">ğŸ’°</div>
          </div>
          <div class="wallet-user-meta">
            <div class="name" id="walletUserName">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
            <div class="sub" id="walletUserId">id: ...</div>
          </div>
        </div>

        <div class="wallet-controls">
          <a href="https://t.me/Baridi_Mob_dz" target="_blank" class="wallet-channel-btn">
            Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ
          </a>
        </div>
      </div>

      <div class="wallet-content">
        <div class="wallet-balance-card">
          <div class="wallet-balance-left">
            <div class="wallet-bal-label">Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
            <div class="wallet-bal-amount" id="walletTotalBalance">0.00 Ø¯Ø¬</div>
          </div>
          <div class="wallet-bal-trend" id="walletTrend">+0.0%</div>
        </div>

        <div class="wallet-actions">
          <button class="wallet-send-btn" id="walletSendBtn">ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…ÙˆØ§Ù„</button>
          <button class="wallet-neon-btn" id="walletReceiveBtn">ğŸ“¥ Ø§Ø³ØªÙ„Ø§Ù… Ø£Ù…ÙˆØ§Ù„</button>
          <button class="wallet-exchange-btn" id="walletNetworkBtn">ğŸ”— Ø´Ø¨ÙƒØ© Ø§Ù„ØªØ¨Ø§Ø¯Ù„</button>
        </div>

        <div>
          <div class="wallet-section-title">Ù…Ø­ÙØ¸ØªÙŠ Ø§Ù„Ø¹Ù…Ù„Ø§Øª</div>
          <div class="wallet-wallets" id="walletWalletsList">
            <!-- Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
          </div>
        </div>

        <div class="wallet-smallnote">Â© 2025 â€” Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ© Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠØ©</div>
      </div>
    </div>

    <!-- Loading Spinner -->
    <div class="wallet-loading-spinner" id="walletLoadingSpinner">
      <div class="wallet-spinner"></div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ -->
    <div class="wallet-modal" id="walletSendModal">
      <div class="wallet-modal-card">
        <h3>Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„</h3>
        <div style="font-size:13px;color:var(--text-light);margin-bottom:10px">Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…ÙˆØ§Ù„ Ø¥Ù„Ù‰ Ù…Ø³ØªØ®Ø¯Ù… Ø¢Ø®Ø±</div>

        <div class="currency-switcher">
          <div class="currency-tab active" onclick="setSendCurrency('DZD')">Ø¥Ø±Ø³Ø§Ù„ Ø¯ÙŠÙ†Ø§Ø±</div>
          <div class="currency-tab usd" onclick="setSendCurrency('USD')">Ø¥Ø±Ø³Ø§Ù„ Ø¯ÙˆÙ„Ø§Ø±</div>
        </div>

        <div class="transfer-form">
          <div class="form-group">
            <label class="form-label">Ø¥Ù„Ù‰ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
            <input type="text" class="form-input" id="sendToUserId" placeholder="Ø£Ø¯Ø®Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" oninput="searchUser(this.value)">
            <div id="userSearchResult" class="user-search-result" style="display:none"></div>
          </div>

          <div class="form-group">
            <label class="form-label">Ø§Ù„Ù…Ø¨Ù„Øº</label>
            <input type="number" class="form-input" id="sendAmount" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº">
            <div style="font-size:12px;color:var(--text-light);margin-top:5px">
              <span id="sendMinAmount">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø¥Ø±Ø³Ø§Ù„: 10 Ø¯Ø¬</span>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">ÙˆØµÙ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <input type="text" class="form-input" id="sendDescription" placeholder="Ø£Ø¯Ø®Ù„ ÙˆØµÙØ§Ù‹ Ù„Ù„Ù…Ø¹Ø§Ù…Ù„Ø©">
          </div>

          <div style="display:flex;gap:8px;margin-top:12px;justify-content:flex-end">
            <button id="walletConfirmSend" class="wallet-neon-btn" style="padding:8px 12px;font-size:13px">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</button>
            <button id="walletCancelSend" class="wallet-ghost-btn" style="padding:8px 12px;font-size:13px">Ø¥Ù„ØºØ§Ø¡</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ø´Ø¨ÙƒØ© Ø§Ù„ØªØ¨Ø§Ø¯Ù„ -->
  <div class="exchange-modal" id="exchangeModal">
    <div class="exchange-header">
      <button class="exchange-close-btn" id="exchangeCloseBtn">&times;</button>
      <div>
        <h1 class="exchange-title">Ù…Ù†ØµØ© ØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª</h1>
        <p class="exchange-subtitle">ØªØ¨Ø§Ø¯Ù„ Ø³Ø±ÙŠØ¹ Ù„Ù„Ø¹Ù…Ù„Ø§Øª Ø¨ÙŠÙ† Ø§Ù„Ø£ÙØ±Ø§Ø¯ Ù…Ø¨Ø§Ø´Ø±Ø©</p>
      </div>
    </div>

    <div class="exchange-filters">
      <button class="exchange-filter-btn active" data-filter="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
      <button class="exchange-filter-btn" data-filter="sell-dzd">Ø¨ÙŠØ¹ Ø¯ÙŠÙ†Ø§Ø±</button>
      <button class="exchange-filter-btn" data-filter="sell-usd">Ø¨ÙŠØ¹ Ø¯ÙˆÙ„Ø§Ø±</button>
    </div>

    <div class="exchange-container" id="exchangeContainer">
      <!-- Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
    </div>

    <button class="exchange-create-btn" id="exchangeCreateBtn">
      <i class="fas fa-plus"></i>
    </button>

    <div class="exchange-footer">
      <p><i class="fas fa-info-circle"></i> Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ù„ØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ù…Ø¹ Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø± Ø¨Ø£Ù…Ø§Ù†.</p>
    </div>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ ØªØ¨Ø§Ø¯Ù„ Ø¬Ø¯ÙŠØ¯ -->
  <div class="create-exchange-modal" id="createExchangeModal">
    <div class="create-exchange-header">
      <button class="create-exchange-close-btn" id="createExchangeCloseBtn">&times;</button>
      <div>
        <h1 class="exchange-title">Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ ØªØ¨Ø§Ø¯Ù„ Ø¬Ø¯ÙŠØ¯</h1>
        <p class="exchange-subtitle">Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ù„ØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ù…Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†</p>
      </div>
    </div>

    <div class="create-exchange-form">
      <div class="balance-info">
        <div>Ø±ØµÙŠØ¯ Ø§Ù„Ø¯ÙŠÙ†Ø§Ø± Ø§Ù„Ù…ØªÙˆÙØ±: <span id="availableDZD">0.00 Ø¯Ø¬</span></div>
        <div>Ø±ØµÙŠØ¯ Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ø§Ù„Ù…ØªÙˆÙØ±: <span id="availableUSD">0.00 $</span></div>
      </div>

      <div class="form-group">
        <label class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨</label>
        <select class="form-select" id="exchangeType">
          <option value="sell-dzd">Ø¨ÙŠØ¹ Ø¯ÙŠÙ†Ø§Ø± Ù…Ù‚Ø§Ø¨Ù„ Ø¯ÙˆÙ„Ø§Ø±</option>
          <option value="sell-usd">Ø¨ÙŠØ¹ Ø¯ÙˆÙ„Ø§Ø± Ù…Ù‚Ø§Ø¨Ù„ Ø¯ÙŠÙ†Ø§Ø±</option>
        </select>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø°ÙŠ ØªØ¨ÙŠØ¹Ù‡</label>
          <input type="number" class="form-input" id="sellAmount" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº" step="0.01" min="0.01">
        </div>
        <div class="form-group">
          <label class="form-label">Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù</label>
          <input type="number" class="form-input" id="exchangeRate" placeholder="Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù" step="0.01" min="0.01">
        </div>
      </div>

      <div class="form-group" style="margin-top: 20px;">
        <div style="background: var(--bg-lighter); padding: 15px; border-radius: 10px; border: 1px solid var(--border-light);">
          <div style="font-size: 14px; color: var(--text-dark); font-weight: 600; margin-bottom: 5px;">Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨:</div>
          <div style="font-size: 13px; color: var(--text-gray);">
            <div>Ø§Ù„Ù…Ø¨Ù„Øº: <span id="summaryAmount">0</span></div>
            <div>Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù: <span id="summaryRate">0</span></div>
            <div>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="summaryTotal">0</span></div>
          </div>
        </div>
      </div>

      <div style="display:flex;gap:10px;margin-top:20px;">
        <button id="createExchangeSubmit" class="wallet-neon-btn" style="flex:1;padding:12px;">
          <i class="fas fa-check-circle"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨
        </button>
        <button id="createExchangeCancel" class="wallet-ghost-btn" style="flex:1;padding:12px;">
          <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
        </button>
      </div>
    </div>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ø­ÙˆØ§Ø± ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ¨Ø§Ø¯Ù„ -->
  <div class="exchange-dialog" id="exchangeDialog">
    <div class="exchange-dialog-content">
      <div class="exchange-dialog-header">
        <div class="exchange-dialog-title">
          <i class="fas fa-handshake"></i>
          ØªØ£ÙƒÙŠØ¯ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ¨Ø§Ø¯Ù„
        </div>
        <button class="exchange-dialog-close" id="exchangeDialogClose">&times;</button>
      </div>
      
      <div class="exchange-dialog-message" id="exchangeDialogMessage">
        <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
      </div>
      
      <div class="exchange-dialog-details">
        <div class="exchange-dialog-item">
          <span class="exchange-dialog-label">Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</span>
          <span class="exchange-dialog-value" id="exchangeTransactionId">TRX-001</span>
        </div>
        <div class="exchange-dialog-item">
          <span class="exchange-dialog-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</span>
          <span class="exchange-dialog-value" id="exchangeTransactionDate">--/--/---- --:--</span>
        </div>
        <div class="exchange-dialog-item">
          <span class="exchange-dialog-label">Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</span>
          <span class="exchange-dialog-value">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯</span>
        </div>
      </div>
      
      <div class="exchange-dialog-actions">
        <button class="exchange-dialog-btn cancel" id="exchangeDialogCancel">
          <i class="fas fa-times"></i>
          Ø¥Ù„ØºØ§Ø¡
        </button>
        <button class="exchange-dialog-btn confirm" id="exchangeDialogConfirm">
          <i class="fas fa-check"></i>
          ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ¨Ø§Ø¯Ù„
        </button>
      </div>
    </div>
  </div>

  <script>
    // ========== ØªÙ‡ÙŠØ¦Ø© Firebase ==========
    const firebaseConfig = {
      apiKey: "AIzaSyBX8v0qIVjG-Z46fVDeEUDKcPxa_FQF9Qc",
      authDomain: "bnak-belaiba.firebaseapp.com",
      projectId: "bnak-belaiba",
      storageBucket: "bnak-belaiba.firebasestorage.app",
      messagingSenderId: "286736432059",
      appId: "1:286736432059:web:ec1ed4292850f00008229e"
    };

    let db;
    let firebaseApp;
    let currentExchangeOrderId = null;

    try {
      firebaseApp = firebase.initializeApp(firebaseConfig);
      db = firebase.firestore(firebaseApp);
      console.log('âœ… Firebase initialized successfully');
    } catch (error) {
      console.error('âŒ Firebase initialization error:', error);
      showToast('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
    }

    // ========== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ==========
    let currentUser = {
      id: null,
      firstName: 'Ù…Ø³ØªØ®Ø¯Ù…',
      lastName: '',
      username: null
    };

    const coinInfo = {
      'DZD': { name: 'Ø§Ù„Ø¯ÙŠÙ†Ø§Ø± Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠ', icon: 'Ø¯Ø¬', color: '#006633, #00cc66' },
      'USD': { name: 'Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠ', icon: '$', color: '#0057b7, #2d87ff' }
    };

    let userBalances = {
      'DZD': 0.00,
      'USD': 0.00
    };

    let exchangeRates = {
      'USD_DZD': 134.5,
      'DZD_USD': 0.0074
    };

    let currentSendCurrency = 'DZD';
    let activeExchangeOrders = [];
    let userUnsubscribe = null;
    let exchangeUnsubscribe = null;

    // ========== Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ==========
    function showToast(message, type = 'info') {
      const existingToasts = document.querySelectorAll('.wallet-toast');
      existingToasts.forEach(toast => toast.remove());
      
      const toast = document.createElement('div');
      toast.className = `wallet-toast`;
      toast.textContent = message;
      
      if (type === 'error') {
        toast.style.background = 'rgba(239, 68, 68, 0.9)';
      } else if (type === 'warning') {
        toast.style.background = 'rgba(245, 158, 11, 0.9)';
      } else if (type === 'success') {
        toast.style.background = 'rgba(34, 197, 94, 0.9)';
      }
      
      document.body.appendChild(toast);
      
      setTimeout(() => {
        if (toast.parentNode) {
          toast.style.opacity = '0';
          toast.style.transition = 'opacity 0.3s ease';
          setTimeout(() => {
            if (toast.parentNode) {
              toast.remove();
            }
          }, 300);
        }
      }, 3000);
    }

    function showWalletLoading() {
      document.getElementById('walletLoadingSpinner').style.display = 'flex';
    }

    function hideWalletLoading() {
      document.getElementById('walletLoadingSpinner').style.display = 'none';
    }

    // ========== Ø¯ÙˆØ§Ù„ Firebase Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© ==========
    async function saveUserToFirebase(userData) {
      try {
        if (!db) throw new Error('Firebase ØºÙŠØ± Ù…Ù‡ÙŠØ¦');
        
        const userRef = db.collection('users').doc(userData.id.toString());
        const userDoc = await userRef.get();
        
        if (!userDoc.exists) {
          // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ Ù…Ø¹ Ø£Ø±ØµØ¯Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
          await userRef.set({
            id: userData.id,
            firstName: userData.first_name || userData.firstName,
            lastName: userData.last_name || userData.lastName || '',
            username: userData.username,
            balances: {
              DZD: 10000.00,
              USD: 100.00
            },
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            lastLogin: firebase.firestore.FieldValue.serverTimestamp()
          });
          console.log('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯:', userData.id);
        } else {
          // ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø¢Ø®Ø± Ø¯Ø®ÙˆÙ„ ÙÙ‚Ø·
          await userRef.update({
            lastLogin: firebase.firestore.FieldValue.serverTimestamp()
          });
        }
        
        return true;
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
        return false;
      }
    }

    async function getUserFromFirebase(userId) {
      try {
        if (!db) throw new Error('Firebase ØºÙŠØ± Ù…Ù‡ÙŠØ¦');
        
        const userRef = db.collection('users').doc(userId.toString());
        const userDoc = await userRef.get();
        
        if (userDoc.exists) {
          return userDoc.data();
        } else {
          return null;
        }
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
        return null;
      }
    }

    async function updateUserBalance(userId, currency, amount, isAdd = true) {
      try {
        if (!db) throw new Error('Firebase ØºÙŠØ± Ù…Ù‡ÙŠØ¦');
        
        const userRef = db.collection('users').doc(userId.toString());
        const userDoc = await userRef.get();
        
        if (!userDoc.exists) {
          throw new Error('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
        }
        
        const userData = userDoc.data();
        const currentBalance = userData.balances?.[currency] || 0;
        const newBalance = isAdd ? currentBalance + amount : currentBalance - amount;
        
        if (newBalance < 0) {
          throw new Error('Ø§Ù„Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙŠ');
        }
        
        await userRef.update({
          [`balances.${currency}`]: newBalance
        });
        
        return newBalance;
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ØµÙŠØ¯:', error);
        throw error;
      }
    }

    async function transferMoney(senderId, receiverId, currency, amount, description = '') {
      try {
        showWalletLoading();
        
        // Ø®ØµÙ… Ø§Ù„Ù…Ø¨Ù„Øº Ù…Ù† Ø§Ù„Ù…Ø±Ø³Ù„
        await updateUserBalance(senderId, currency, amount, false);
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¨Ù„Øº Ù„Ù„Ù…Ø³ØªÙ‚Ø¨Ù„
        await updateUserBalance(receiverId, currency, amount, true);
        
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©
        const transactionRef = db.collection('transactions').doc();
        await transactionRef.set({
          id: transactionRef.id,
          senderId: senderId,
          receiverId: receiverId,
          currency: currency,
          amount: amount,
          description: description,
          type: 'transfer',
          status: 'completed',
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        showToast(`âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ${amount} ${currency} Ø¨Ù†Ø¬Ø§Ø­`, 'success');
        return true;
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„:', error);
        showToast(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„: ${error.message}`, 'error');
        return false;
      } finally {
        hideWalletLoading();
      }
    }

    async function createExchangeOrder(userId, type, sellAmount, exchangeRate) {
      try {
        showWalletLoading();
        
        const sellCurrency = type === 'sell-usd' ? 'USD' : 'DZD';
        const receiveCurrency = type === 'sell-usd' ? 'DZD' : 'USD';
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„ÙƒØ§ÙÙŠ
        const userData = await getUserFromFirebase(userId);
        if (!userData || (userData.balances?.[sellCurrency] || 0) < sellAmount) {
          throw new Error('Ø§Ù„Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙŠ');
        }
        
        // ØªØ¬Ù…ÙŠØ¯ Ø§Ù„Ù…Ø¨Ù„Øº Ù…Ù† Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        await updateUserBalance(userId, sellCurrency, sellAmount, false);
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø§Ø¯Ù„
        const orderRef = db.collection('exchange_orders').doc();
        const orderData = {
          id: orderRef.id,
          userId: userId,
          userName: userData.firstName || 'Ù…Ø³ØªØ®Ø¯Ù…',
          type: type,
          sellCurrency: sellCurrency,
          sellAmount: sellAmount,
          receiveCurrency: receiveCurrency,
          exchangeRate: exchangeRate,
          status: 'active',
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        await orderRef.set(orderData);
        
        showToast('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø§Ø¯Ù„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        return orderRef.id;
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø§Ø¯Ù„:', error);
        showToast(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø§Ø¯Ù„: ${error.message}`, 'error');
        return null;
      } finally {
        hideWalletLoading();
      }
    }

    async function executeExchange(orderId, buyerId) {
      try {
        showWalletLoading();
        
        // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨
        const orderRef = db.collection('exchange_orders').doc(orderId);
        const orderDoc = await orderRef.get();
        
        if (!orderDoc.exists) {
          throw new Error('Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø§Ø¯Ù„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
        }
        
        const order = orderDoc.data();
        
        if (order.status !== 'active') {
          throw new Error('Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø§Ø¯Ù„ ØºÙŠØ± Ù…ØªØ§Ø­');
        }
        
        if (order.userId === buyerId) {
          throw new Error('Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ¨Ø§Ø¯Ù„ Ù…Ø¹ Ù†ÙØ³Ùƒ');
        }
        
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ø§Ù„Øº
        let buyerSellAmount, buyerReceiveAmount, sellerReceiveAmount;
        
        if (order.type === 'sell-usd') {
          // Ø§Ù„Ø¨Ø§Ø¦Ø¹ ÙŠØ¨ÙŠØ¹ Ø¯ÙˆÙ„Ø§Ø±ØŒ Ø§Ù„Ù…Ø´ØªØ±ÙŠ ÙŠØ¨ÙŠØ¹ Ø¯ÙŠÙ†Ø§Ø±
          buyerSellAmount = order.sellAmount * order.exchangeRate; // Ø¯ÙŠÙ†Ø§Ø± ÙŠØ¨ÙŠØ¹Ù‡ Ø§Ù„Ù…Ø´ØªØ±ÙŠ
          buyerReceiveAmount = order.sellAmount; // Ø¯ÙˆÙ„Ø§Ø± ÙŠØ³ØªÙ„Ù…Ù‡ Ø§Ù„Ù…Ø´ØªØ±ÙŠ
          sellerReceiveAmount = buyerSellAmount; // Ø¯ÙŠÙ†Ø§Ø± ÙŠØ³ØªÙ„Ù…Ù‡ Ø§Ù„Ø¨Ø§Ø¦Ø¹
        } else {
          // Ø§Ù„Ø¨Ø§Ø¦Ø¹ ÙŠØ¨ÙŠØ¹ Ø¯ÙŠÙ†Ø§Ø±ØŒ Ø§Ù„Ù…Ø´ØªØ±ÙŠ ÙŠØ¨ÙŠØ¹ Ø¯ÙˆÙ„Ø§Ø±
          buyerSellAmount = order.sellAmount / order.exchangeRate; // Ø¯ÙˆÙ„Ø§Ø± ÙŠØ¨ÙŠØ¹Ù‡ Ø§Ù„Ù…Ø´ØªØ±ÙŠ
          buyerReceiveAmount = order.sellAmount; // Ø¯ÙŠÙ†Ø§Ø± ÙŠØ³ØªÙ„Ù…Ù‡ Ø§Ù„Ù…Ø´ØªØ±ÙŠ
          sellerReceiveAmount = buyerSellAmount; // Ø¯ÙˆÙ„Ø§Ø± ÙŠØ³ØªÙ„Ù…Ù‡ Ø§Ù„Ø¨Ø§Ø¦Ø¹
        }
        
        // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´ØªØ±ÙŠ
        const buyerData = await getUserFromFirebase(buyerId);
        if (!buyerData) {
          throw new Error('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´ØªØ±ÙŠ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©');
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø´ØªØ±ÙŠ
        const buyerCurrency = order.type === 'sell-usd' ? 'DZD' : 'USD';
        if ((buyerData.balances?.[buyerCurrency] || 0) < buyerSellAmount) {
          throw new Error('Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø´ØªØ±ÙŠ ØºÙŠØ± ÙƒØ§ÙÙŠ');
        }
        
        // ØªÙ†ÙÙŠØ° Ø§Ù„ØªØ¨Ø§Ø¯Ù„ ÙÙŠ Ù…Ø¹Ø§Ù…Ù„Ø© ÙˆØ§Ø­Ø¯Ø© (ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„ØªÙˆØ§ÙÙ‚ÙŠØ©)
        const batch = db.batch();
        
        // Ø®ØµÙ… Ø§Ù„Ù…Ø¨Ù„Øº Ù…Ù† Ø§Ù„Ù…Ø´ØªØ±ÙŠ
        const buyerRef = db.collection('users').doc(buyerId.toString());
        const buyerCurrentBalance = buyerData.balances?.[buyerCurrency] || 0;
        batch.update(buyerRef, {
          [`balances.${buyerCurrency}`]: buyerCurrentBalance - buyerSellAmount
        });
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±Ø§Ø© Ù„Ù„Ù…Ø´ØªØ±ÙŠ
        const buyerReceiveCurrency = order.type === 'sell-usd' ? 'USD' : 'DZD';
        const buyerCurrentReceiveBalance = buyerData.balances?.[buyerReceiveCurrency] || 0;
        batch.update(buyerRef, {
          [`balances.${buyerReceiveCurrency}`]: buyerCurrentReceiveBalance + buyerReceiveAmount
        });
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø© Ù„Ù„Ø¨Ø§Ø¦Ø¹
        const sellerRef = db.collection('users').doc(order.userId.toString());
        const sellerData = await sellerRef.get();
        const sellerCurrentBalance = sellerData.data()?.balances?.[order.sellCurrency] || 0;
        batch.update(sellerRef, {
          [`balances.${order.sellCurrency}`]: sellerCurrentBalance + sellerReceiveAmount
        });
        
        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
        batch.update(orderRef, {
          status: 'completed',
          buyerId: buyerId,
          buyerName: buyerData.firstName || 'Ù…Ø´ØªØ±ÙŠ',
          completedAt: firebase.firestore.FieldValue.serverTimestamp(),
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        // ØªØ³Ø¬ÙŠÙ„ Ù…Ø¹Ø§Ù…Ù„Ø© Ø§Ù„ØªØ¨Ø§Ø¯Ù„
        const transactionRef = db.collection('transactions').doc();
        batch.set(transactionRef, {
          id: transactionRef.id,
          orderId: orderId,
          sellerId: order.userId,
          buyerId: buyerId,
          sellerCurrency: order.sellCurrency,
          sellerAmount: order.sellAmount,
          buyerCurrency: buyerCurrency,
          buyerAmount: buyerSellAmount,
          exchangeRate: order.exchangeRate,
          type: 'exchange',
          status: 'completed',
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        // ØªÙ†ÙÙŠØ° Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ÙÙŠ Ø¯ÙØ¹Ø© ÙˆØ§Ø­Ø¯Ø©
        await batch.commit();
        
        showToast('âœ… ØªÙ… Ø¥ØªÙ…Ø§Ù… Ø§Ù„ØªØ¨Ø§Ø¯Ù„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        return true;
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ†ÙÙŠØ° Ø§Ù„ØªØ¨Ø§Ø¯Ù„:', error);
        showToast(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ¨Ø§Ø¯Ù„: ${error.message}`, 'error');
        return false;
      } finally {
        hideWalletLoading();
      }
    }

    async function cancelExchangeOrder(orderId, userId) {
      try {
        showWalletLoading();
        
        const orderRef = db.collection('exchange_orders').doc(orderId);
        const orderDoc = await orderRef.get();
        
        if (!orderDoc.exists) {
          throw new Error('Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø§Ø¯Ù„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
        }
        
        const order = orderDoc.data();
        
        if (order.userId !== userId) {
          throw new Error('Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ù„ØºØ§Ø¡ Ø·Ù„Ø¨ Ù„ÙŠØ³ Ù„Ùƒ');
        }
        
        if (order.status !== 'active') {
          throw new Error('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ù„ØºØ§Ø¡ Ø·Ù„Ø¨ ØºÙŠØ± Ù†Ø´Ø·');
        }
        
        // Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¬Ù…Ø¯ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
        await updateUserBalance(userId, order.sellCurrency, order.sellAmount, true);
        
        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
        await orderRef.update({
          status: 'cancelled',
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        showToast('âœ… ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø§Ø¯Ù„', 'success');
        return true;
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù„ØºØ§Ø¡ Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø§Ø¯Ù„:', error);
        showToast(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ù„ØºØ§Ø¡: ${error.message}`, 'error');
        return false;
      } finally {
        hideWalletLoading();
      }
    }

    function setupRealtimeUserListener(userId) {
      if (userUnsubscribe) {
        userUnsubscribe();
      }
      
      userUnsubscribe = db.collection('users').doc(userId.toString())
        .onSnapshot((doc) => {
          if (doc.exists) {
            const userData = doc.data();
            updateUserInterface(userData);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø±ØµØ¯Ø©
            if (userData.balances) {
              userBalances.DZD = userData.balances.DZD || 0;
              userBalances.USD = userData.balances.USD || 0;
              
              updateWalletsListRealTime();
              updateTotalBalance();
              updateAvailableBalances();
            }
          }
        }, (error) => {
          console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
        });
    }

    function setupRealtimeExchangeListener() {
      if (exchangeUnsubscribe) {
        exchangeUnsubscribe();
      }
      
      exchangeUnsubscribe = db.collection('exchange_orders')
        .where('status', '==', 'active')
        .orderBy('createdAt', 'desc')
        .onSnapshot((snapshot) => {
          activeExchangeOrders = [];
          snapshot.forEach((doc) => {
            const order = doc.data();
            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
            order.createdAt = order.createdAt?.toDate() || new Date();
            activeExchangeOrders.push(order);
          });
          
          renderExchangeCards();
        }, (error) => {
          console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„ØªØ¨Ø§Ø¯Ù„:', error);
        });
    }

    // ========== Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø­ÙØ¸Ø© ==========
    function updateUserInterface(userData) {
      try {
        const userName = userData.firstName || userData.first_name || 'Ù…Ø³ØªØ®Ø¯Ù…';
        const userLastName = userData.lastName || userData.last_name || '';
        const fullName = userName + (userLastName ? ' ' + userLastName : '');
        
        document.getElementById('walletUserName').textContent = fullName;
        document.getElementById('walletUserId').textContent = `id: ${userData.id}`;
        document.getElementById('walletUserId').setAttribute('onclick', `copyUserId(${userData.id})`);
        document.getElementById('walletCoinIcon').textContent = 'ğŸ’°';
        
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
      }
    }

    function copyUserId(userId) {
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(userId.toString()).then(() => {
          showToast('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù…Ø¹Ø±Ù: ' + userId);
        }).catch(err => {
          fallbackCopy(userId);
        });
      } else {
        fallbackCopy(userId);
      }
    }

    function fallbackCopy(userId) {
      const textArea = document.createElement('textarea');
      textArea.value = userId.toString();
      document.body.appendChild(textArea);
      textArea.select();
      document.execCommand('copy');
      document.body.removeChild(textArea);
      showToast('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù…Ø¹Ø±Ù: ' + userId);
    }

    function updateWalletsListRealTime() {
      const walletsList = document.getElementById('walletWalletsList');
      
      // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø£ÙˆÙ„Ø§Ù‹
      walletsList.innerHTML = '';
      
      // Ø¥Ø¶Ø§ÙØ© Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø¯ÙŠÙ†Ø§Ø±
      const dzdBalance = userBalances['DZD'] || 0;
      const dzdElement = document.createElement('div');
      dzdElement.className = 'wallet-coin-row';
      dzdElement.innerHTML = `
        <div style="display:flex;align-items:center;gap:12px">
          <div class="wallet-badge">Ø¯Ø¬</div>
          <div class="wallet-coin-meta">
            <div class="n">Ø§Ù„Ø¯ÙŠÙ†Ø§Ø± Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠ</div>
            <div class="s">DZD - Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„ÙˆØ·Ù†ÙŠØ©</div>
            <div class="rate">1 Ø¯Ø¬ = ${exchangeRates.DZD_USD.toFixed(4)} $</div>
          </div>
        </div>
        <div class="wallet-coin-val">
          <div class="qty">${dzdBalance.toFixed(2)} DZD</div>
          <div class="fiat">${(dzdBalance * exchangeRates.DZD_USD).toFixed(2)} $</div>
          <div class="change positive">â†» Ù…Ø­ÙØ¸Ø© Ù†Ø´Ø·Ø©</div>
        </div>
      `;
      walletsList.appendChild(dzdElement);
      
      // Ø¥Ø¶Ø§ÙØ© Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±
      const usdBalance = userBalances['USD'] || 0;
      const usdElement = document.createElement('div');
      usdElement.className = 'wallet-coin-row';
      usdElement.innerHTML = `
        <div style="display:flex;align-items:center;gap:12px">
          <div class="wallet-badge usd">$</div>
          <div class="wallet-coin-meta">
            <div class="n">Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠ</div>
            <div class="s">USD - Ø¹Ù…Ù„Ø© Ø¯ÙˆÙ„ÙŠØ©</div>
            <div class="rate">1 $ = ${exchangeRates.USD_DZD.toFixed(2)} Ø¯Ø¬</div>
          </div>
        </div>
        <div class="wallet-coin-val">
          <div class="qty">${usdBalance.toFixed(2)} USD</div>
          <div class="fiat">${(usdBalance * exchangeRates.USD_DZD).toFixed(2)} Ø¯Ø¬</div>
          <div class="change positive">â†» Ù…Ø­ÙØ¸Ø© Ù†Ø´Ø·Ø©</div>
        </div>
      `;
      walletsList.appendChild(usdElement);
    }

    function updateTotalBalance() {
      let totalBalanceDZD = 0;
      
      // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¯ÙŠÙ†Ø§Ø±
      totalBalanceDZD += userBalances['DZD'] || 0;
      
      // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ù…Ø­ÙˆÙ„ Ù„Ù„Ø¯ÙŠÙ†Ø§Ø±
      totalBalanceDZD += (userBalances['USD'] || 0) * exchangeRates.USD_DZD;
      
      document.getElementById('walletTotalBalance').textContent = `${totalBalanceDZD.toFixed(2)} Ø¯Ø¬`;
    }

    function updateAvailableBalances() {
      document.getElementById('availableDZD').textContent = `${userBalances['DZD'].toFixed(2)} Ø¯Ø¬`;
      document.getElementById('availableUSD').textContent = `${userBalances['USD'].toFixed(2)} $`;
    }

    // ========== Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ==========
    function setSendCurrency(currency) {
      currentSendCurrency = currency;
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù†Ø´Ø·Ø©
      document.querySelectorAll('.currency-tab').forEach(tab => {
        tab.classList.remove('active');
        if ((currency === 'DZD' && !tab.classList.contains('usd')) || 
            (currency === 'USD' && tab.classList.contains('usd'))) {
          tab.classList.add('active');
        }
      });
      
      if (currency === 'DZD') {
        document.getElementById('sendMinAmount').textContent = 'Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø¥Ø±Ø³Ø§Ù„: 10 Ø¯Ø¬';
      } else {
        document.getElementById('sendMinAmount').textContent = 'Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø¥Ø±Ø³Ø§Ù„: 1 $';
      }
    }

    async function searchUser(userId) {
      const resultDiv = document.getElementById('userSearchResult');
      
      if (!userId || userId.trim() === '') {
        resultDiv.style.display = 'none';
        return;
      }
      
      if (userId === currentUser.id.toString()) {
        resultDiv.innerHTML = `<i class="fas fa-times-circle"></i> Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…ÙˆØ§Ù„ Ù„Ù†ÙØ³Ùƒ`;
        resultDiv.className = 'user-search-result not-found';
        resultDiv.style.display = 'block';
        return;
      }
      
      try {
        const userData = await getUserFromFirebase(userId);
        
        if (userData) {
          const userName = userData.firstName || 'Ù…Ø³ØªØ®Ø¯Ù…';
          resultDiv.innerHTML = `<i class="fas fa-check-circle"></i> ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${userName}`;
          resultDiv.className = 'user-search-result found';
          resultDiv.style.display = 'block';
        } else {
          resultDiv.innerHTML = `<i class="fas fa-times-circle"></i> Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…`;
          resultDiv.className = 'user-search-result not-found';
          resultDiv.style.display = 'block';
        }
      } catch (error) {
        resultDiv.innerHTML = `<i class="fas fa-times-circle"></i> Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…`;
        resultDiv.className = 'user-search-result not-found';
        resultDiv.style.display = 'block';
      }
    }

    async function processSendTransaction() {
      const toUserId = document.getElementById('sendToUserId').value;
      const amount = parseFloat(document.getElementById('sendAmount').value);
      const description = document.getElementById('sendDescription').value;
      
      if (!toUserId || !amount || amount <= 0) {
        showToast('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­', 'error');
        return;
      }
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰
      const minAmount = currentSendCurrency === 'DZD' ? 10 : 1;
      if (amount < minAmount) {
        showToast(`Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø¥Ø±Ø³Ø§Ù„ Ù‡Ùˆ ${minAmount} ${currentSendCurrency}`, 'error');
        return;
      }
      
      if (toUserId === currentUser.id.toString()) {
        showToast('Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…ÙˆØ§Ù„ Ù„Ù†ÙØ³Ùƒ', 'error');
        return;
      }
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      const receiverData = await getUserFromFirebase(toUserId);
      if (!receiverData) {
        showToast('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
        return;
      }
      
      // ØªÙ†ÙÙŠØ° Ø§Ù„ØªØ­ÙˆÙŠÙ„
      const success = await transferMoney(
        currentUser.id,
        toUserId,
        currentSendCurrency,
        amount,
        description
      );
      
      if (success) {
        document.getElementById('walletSendModal').classList.remove('open');
        document.getElementById('sendToUserId').value = '';
        document.getElementById('sendAmount').value = '';
        document.getElementById('sendDescription').value = '';
        document.getElementById('userSearchResult').style.display = 'none';
      }
    }

    // ========== Ø¯ÙˆØ§Ù„ Ø´Ø¨ÙƒØ© Ø§Ù„ØªØ¨Ø§Ø¯Ù„ ==========
    function openExchangeModal() {
      document.getElementById('exchangeModal').classList.add('open');
    }

    function closeExchangeModal() {
      document.getElementById('exchangeModal').classList.remove('open');
    }

    function openCreateExchangeModal() {
      updateAvailableBalances();
      document.getElementById('createExchangeModal').classList.add('open');
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„
      document.getElementById('sellAmount').value = '';
      document.getElementById('exchangeRate').value = '';
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ø®Øµ
      updateExchangeSummary();
    }

    function closeCreateExchangeModal() {
      document.getElementById('createExchangeModal').classList.remove('open');
    }

    function renderExchangeCards() {
      const container = document.getElementById('exchangeContainer');
      container.innerHTML = '';

      if (activeExchangeOrders.length === 0) {
        container.innerHTML = `
          <div style="text-align:center;padding:40px 20px;color:var(--text-light);">
            <i class="fas fa-exchange-alt" style="font-size:48px;margin-bottom:15px;opacity:0.5;"></i>
            <div style="font-size:16px;margin-bottom:10px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª ØªØ¨Ø§Ø¯Ù„ Ø­Ø§Ù„ÙŠØ§Ù‹</div>
            <div style="font-size:14px;">ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠÙ†Ø´Ø¦ Ø·Ù„Ø¨ ØªØ¨Ø§Ø¯Ù„!</div>
          </div>
        `;
        return;
      }

      activeExchangeOrders.forEach(order => {
        // Ù„Ø§ ØªØ¹Ø±Ø¶ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù†ÙØ³Ù‡
        if (order.userId === currentUser.id.toString()) return;
        
        const card = document.createElement('div');
        card.className = 'exchange-card';
        card.setAttribute('data-type', order.type);
        
        const badgeClass = order.type === 'sell-usd' ? 'sell-usd' : 'sell-dzd';
        const badgeIcon = order.type === 'sell-usd' ? 'fa-dollar-sign' : 'fa-dinar-sign';
        const currencyIcon = order.type === 'sell-usd' ? 'fa-dollar-sign' : 'fa-dinar-sign';
        
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
        const totalAmount = order.type === 'sell-usd' 
          ? (order.sellAmount * order.exchangeRate).toFixed(0)
          : (order.sellAmount / order.exchangeRate).toFixed(2);
          
        const totalDisplay = order.type === 'sell-usd'
          ? `${totalAmount} Ø¯Ø¬`
          : `${totalAmount} $`;
        
        // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª
        const orderTime = order.createdAt;
        const timeString = orderTime ? orderTime.toLocaleTimeString('ar-EG', {
          hour: '2-digit',
          minute: '2-digit'
        }) : 'Ø§Ù„Ø¢Ù†';
        
        card.innerHTML = `
          <div class="exchange-card-header">
            <div class="exchange-badge ${badgeClass}">
              <i class="fas ${badgeIcon}"></i>
              ${order.type === 'sell-usd' ? 'Ø¨ÙŠØ¹ Ø¯ÙˆÙ„Ø§Ø±' : 'Ø¨ÙŠØ¹ Ø¯ÙŠÙ†Ø§Ø±'}
            </div>
            <div class="exchange-user-info">
              <div class="exchange-avatar">${order.userName?.charAt(0) || 'Ù…'}</div>
              <div class="exchange-user-name">${order.userName || 'Ù…Ø³ØªØ®Ø¯Ù…'}</div>
            </div>
          </div>
          
          <div class="exchange-card-body">
            <div class="exchange-currency-info">
              <div class="exchange-currency-details">
                <div class="exchange-currency-name">
                  <i class="fas ${currencyIcon}"></i>
                  ${order.type === 'sell-usd' ? 'Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ' : 'Ø¯ÙŠÙ†Ø§Ø± Ø¬Ø²Ø§Ø¦Ø±ÙŠ'}
                </div>
                <div class="exchange-currency-amount">Ø§Ù„ÙƒÙ…ÙŠØ©: ${order.sellAmount.toLocaleString()} ${order.sellCurrency}</div>
              </div>
              <div class="exchange-rate">
                <span class="exchange-rate-label">Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù</span>
                <span class="exchange-rate-value">1${order.type === 'sell-usd' ? '$' : 'Ø¯Ø¬'} = ${order.exchangeRate}${order.type === 'sell-usd' ? 'Ø¯Ø¬' : '$'}</span>
              </div>
            </div>
            
            <div class="exchange-info">
              <span>ÙŠØ³ØªÙ‚Ø¨Ù„:</span>
              <i class="fas fa-arrow-left"></i>
              <span>${order.type === 'sell-usd' ? 'Ø¯ÙŠÙ†Ø§Ø± Ø¬Ø²Ø§Ø¦Ø±ÙŠ' : 'Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ'}</span>
            </div>
            
            <div class="exchange-details">
              <div class="exchange-detail-item">
                <span class="exchange-detail-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</span>
                <span class="exchange-detail-value">${timeString}</span>
              </div>
              <div class="exchange-detail-item">
                <span class="exchange-detail-label">Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</span>
                <span class="exchange-detail-value" style="color: var(--success);">Ù†Ø´Ø·</span>
              </div>
            </div>
            
            <div class="exchange-total-container">
              <span class="exchange-total-label">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
              <span class="exchange-total-value">${totalDisplay}</span>
            </div>
            
            <button class="exchange-action-btn" data-id="${order.id}">
              <i class="fas fa-exchange-alt"></i>
              Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ù…Ø¹Ù‡
            </button>
          </div>
        `;
        
        container.appendChild(card);
      });

      // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ù„Ù„ÙÙ„Ø§ØªØ±
      document.querySelectorAll('.exchange-filter-btn').forEach(button => {
        button.addEventListener('click', function() {
          document.querySelectorAll('.exchange-filter-btn').forEach(btn => btn.classList.remove('active'));
          this.classList.add('active');
          
          const filter = this.getAttribute('data-filter');
          const cards = document.querySelectorAll('.exchange-card');
          
          cards.forEach(card => {
            const cardType = card.getAttribute('data-type');
            
            if (filter === 'all') {
              card.style.display = 'flex';
            } else {
              card.style.display = cardType === filter ? 'flex' : 'none';
            }
          });
        });
      });

      // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¨Ø§Ø¯Ù„
      document.querySelectorAll('.exchange-action-btn').forEach(button => {
        button.addEventListener('click', function() {
          const orderId = this.getAttribute('data-id');
          const order = activeExchangeOrders.find(o => o.id == orderId);
          
          if (order) {
            currentExchangeOrderId = orderId;
            const actionType = order.type === 'sell-usd' ? 'Ø´Ø±Ø§Ø¡ Ø¯ÙˆÙ„Ø§Ø±' : 'Ø´Ø±Ø§Ø¡ Ø¯ÙŠÙ†Ø§Ø±';
            const totalAmount = order.type === 'sell-usd' 
              ? (order.sellAmount * order.exchangeRate).toFixed(0)
              : (order.sellAmount / order.exchangeRate).toFixed(2);
            
            document.getElementById('exchangeDialogMessage').innerHTML = `
              Ø£Ù†Øª Ø¹Ù„Ù‰ ÙˆØ´Ùƒ ${actionType} Ù…Ù† <strong>${order.userName}</strong>.<br><br>
              <strong>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©:</strong><br>
              - Ø§Ù„ÙƒÙ…ÙŠØ©: ${order.sellAmount} ${order.sellCurrency}<br>
              - Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù: 1${order.type === 'sell-usd' ? '$' : 'Ø¯Ø¬'} = ${order.exchangeRate}${order.type === 'sell-usd' ? 'Ø¯Ø¬' : '$'}<br>
              - Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${totalAmount} ${order.type === 'sell-usd' ? 'Ø¯Ø¬' : '$'}<br><br>
              <strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> Ø³ÙŠØªÙ… Ø®ØµÙ… Ø§Ù„Ù…Ø¨Ù„Øº Ù…Ù† Ø±ØµÙŠØ¯Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„ØªØ£ÙƒÙŠØ¯.
            `;
            
            updateTransactionDetails();
            document.getElementById('exchangeDialog').style.display = 'flex';
          }
        });
      });
    }

    function updateTransactionDetails() {
      const now = new Date();
      const formattedDate = now.toLocaleDateString('ar-EG', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });
      const formattedTime = now.toLocaleTimeString('ar-EG', {
        hour: '2-digit',
        minute: '2-digit'
      });
      
      document.getElementById('exchangeTransactionDate').textContent = `${formattedDate} ${formattedTime}`;
      document.getElementById('exchangeTransactionId').textContent = 'TRX-' + String(Math.floor(Math.random() * 1000)).padStart(3, '0');
    }

    async function processExchange() {
      if (!currentExchangeOrderId) {
        showToast('âŒ Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø·Ù„Ø¨ ØªØ¨Ø§Ø¯Ù„', 'error');
        return;
      }
      
      const success = await executeExchange(currentExchangeOrderId, currentUser.id);
      
      if (success) {
        document.getElementById('exchangeDialog').style.display = 'none';
        currentExchangeOrderId = null;
      }
    }

    function updateExchangeSummary() {
      const type = document.getElementById('exchangeType').value;
      const amount = parseFloat(document.getElementById('sellAmount').value) || 0;
      const rate = parseFloat(document.getElementById('exchangeRate').value) || 0;
      
      document.getElementById('summaryAmount').textContent = `${amount} ${type === 'sell-usd' ? '$' : 'Ø¯Ø¬'}`;
      document.getElementById('summaryRate').textContent = `${rate} ${type === 'sell-usd' ? 'Ø¯Ø¬' : '$'}`;
      document.getElementById('summaryTotal').textContent = type === 'sell-usd' 
        ? `${(amount * rate).toFixed(0)} Ø¯Ø¬` 
        : `${(amount / rate).toFixed(2)} $`;
    }

    async function createExchangeOrder() {
      const type = document.getElementById('exchangeType').value;
      const amount = parseFloat(document.getElementById('sellAmount').value);
      const rate = parseFloat(document.getElementById('exchangeRate').value);
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„
      if (!amount || amount <= 0) {
        showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­', 'error');
        return;
      }
      
      if (!rate || rate <= 0) {
        showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¹Ø± ØµØ±Ù ØµØ­ÙŠØ­', 'error');
        return;
      }
      
      const orderId = await createExchangeOrder(currentUser.id, type, amount, rate);
      
      if (orderId) {
        closeCreateExchangeModal();
      }
    }

    // ========== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ==========
    document.addEventListener('DOMContentLoaded', async function() {
      console.log('ğŸš€ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©...');
      
      // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Telegram
      let mockUser = null;
      
      if (window.Telegram && Telegram.WebApp) {
        const tg = Telegram.WebApp;
        tg.ready();
        tg.expand();
        
        const tgUser = tg.initDataUnsafe?.user;
        if (tgUser) {
          mockUser = {
            id: tgUser.id,
            first_name: tgUser.first_name,
            last_name: tgUser.last_name || '',
            username: tgUser.username
          };
          
          // Ø­ÙØ¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Firebase
          await saveUserToFirebase(mockUser);
        }
      }
      
      // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† TelegramØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
      if (!mockUser) {
        mockUser = {
          id: 5922049376,
          first_name: 'Akram',
          last_name: 'Khezzari', 
          username: 'A_mja_d_0_5'
        };
        
        // Ø­ÙØ¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Firebase (Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙÙ‚Ø·)
        await saveUserToFirebase(mockUser);
      }
      
      currentUser = mockUser;
      
      // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Firebase
      const userData = await getUserFromFirebase(currentUser.id);
      if (userData) {
        updateUserInterface(userData);
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø±ØµØ¯Ø©
        if (userData.balances) {
          userBalances.DZD = userData.balances.DZD || 0;
          userBalances.USD = userData.balances.USD || 0;
        }
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ø­ÙŠØ©
        setupRealtimeUserListener(currentUser.id);
        setupRealtimeExchangeListener();
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        updateWalletsListRealTime();
        updateTotalBalance();
        updateAvailableBalances();
      }
      
      // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
      document.getElementById('walletSendBtn').addEventListener('click', function() {
        document.getElementById('walletSendModal').classList.add('open');
      });
      
      document.getElementById('walletCancelSend').addEventListener('click', function() {
        document.getElementById('walletSendModal').classList.remove('open');
      });
      
      // Ø­Ø¯Ø« Ø²Ø± Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… (Ù†Ø³Ø® Ø§Ù„Ù…Ø¹Ø±Ù)
      document.getElementById('walletReceiveBtn').addEventListener('click', function() {
        if (currentUser && currentUser.id) {
          if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(currentUser.id.toString()).then(() => {
              showToast(`âœ… ØªÙ… Ù†Ø³Ø® Ù…Ø¹Ø±ÙÙƒ: ${currentUser.id} - ÙŠÙ…ÙƒÙ† Ù„Ù„Ø¢Ø®Ø±ÙŠÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ Ù„Ùƒ`);
            });
          } else {
            const textArea = document.createElement('textarea');
            textArea.value = currentUser.id.toString();
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            showToast(`âœ… ØªÙ… Ù†Ø³Ø® Ù…Ø¹Ø±ÙÙƒ: ${currentUser.id} - ÙŠÙ…ÙƒÙ† Ù„Ù„Ø¢Ø®Ø±ÙŠÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ Ù„Ùƒ`);
          }
        } else {
          showToast('âŒ Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø¹Ø¯');
        }
      });
      
      // Ø£Ø­Ø¯Ø§Ø« Ø´Ø¨ÙƒØ© Ø§Ù„ØªØ¨Ø§Ø¯Ù„
      document.getElementById('walletNetworkBtn').addEventListener('click', openExchangeModal);
      document.getElementById('exchangeCloseBtn').addEventListener('click', closeExchangeModal);
      document.getElementById('exchangeCreateBtn').addEventListener('click', openCreateExchangeModal);
      document.getElementById('createExchangeCloseBtn').addEventListener('click', closeCreateExchangeModal);
      document.getElementById('createExchangeCancel').addEventListener('click', closeCreateExchangeModal);
      
      // Ø£Ø­Ø¯Ø§Ø« Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ ØªØ¨Ø§Ø¯Ù„
      document.getElementById('createExchangeSubmit').addEventListener('click', createExchangeOrder);
      
      // Ø£Ø­Ø¯Ø§Ø« ØªØ­Ø¯ÙŠØ« Ù…Ù„Ø®Øµ Ø§Ù„ØªØ¨Ø§Ø¯Ù„
      document.getElementById('exchangeType').addEventListener('change', updateExchangeSummary);
      document.getElementById('sellAmount').addEventListener('input', updateExchangeSummary);
      document.getElementById('exchangeRate').addEventListener('input', updateExchangeSummary);
      
      // Ø£Ø­Ø¯Ø§Ø« Ù†Ø§ÙØ°Ø© Ø­ÙˆØ§Ø± Ø§Ù„ØªØ¨Ø§Ø¯Ù„
      document.getElementById('exchangeDialogClose').addEventListener('click', function() {
        document.getElementById('exchangeDialog').style.display = 'none';
        currentExchangeOrderId = null;
      });
      
      document.getElementById('exchangeDialogCancel').addEventListener('click', function() {
        document.getElementById('exchangeDialog').style.display = 'none';
        currentExchangeOrderId = null;
      });
      
      document.getElementById('exchangeDialogConfirm').addEventListener('click', processExchange);
      
      // Ø­Ø¯Ø« ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
      document.getElementById('walletConfirmSend').addEventListener('click', processSendTransaction);
      
      // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø¨Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
      document.getElementById('exchangeModal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeExchangeModal();
        }
      });
      
      document.getElementById('createExchangeModal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeCreateExchangeModal();
        }
      });
      
      document.getElementById('exchangeDialog').addEventListener('click', function(e) {
        if (e.target === this) {
          document.getElementById('exchangeDialog').style.display = 'none';
          currentExchangeOrderId = null;
        }
      });
      
      document.getElementById('walletSendModal').addEventListener('click', function(e) {
        if (e.target === this) {
          document.getElementById('walletSendModal').classList.remove('open');
        }
      });
    });
  </script>
</body>
</html>
